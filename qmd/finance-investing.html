<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Domain Knowledge - Investing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/finance-snippets.html" rel="next">
<link href="../qmd/finance-glossary.html" rel="prev">
<link href="../images/dk-favicon-32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/finance-glossary.html">Finance</a></li><li class="breadcrumb-item"><a href="../qmd/finance-investing.html">Investing</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Domain Knowledge</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="https://github.com/ercbk/Domain-Knowledge-Notebook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/agriculture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agriculture</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/banking-credit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Banking/Credit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/budget-allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Budget Allocation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Economics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/epidemiology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Finance</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-investing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Investing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-snippets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snippets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Valuation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/healthcare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Healthcare</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/insurance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Insurance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kpis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">KPIs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/location-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Location Selection</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Logistics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-demand-planning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demand Planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-inventory-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inventory Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-supply-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supply Chain</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/low-hanging-fruit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Low Hanging Fruit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/manufacturing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manufacturing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/meteorology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meteorology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nonprofits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonprofits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/politics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Politics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/product-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Product Development</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/real-estate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Real Estate</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/retail.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Retail</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/saas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SaaS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/sports-betting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sports Betting</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-finance-invest-misc" id="toc-sec-finance-invest-misc" class="nav-link active" data-scroll-target="#sec-finance-invest-misc">Misc</a></li>
  <li><a href="#sec-finance-invest-consid" id="toc-sec-finance-invest-consid" class="nav-link" data-scroll-target="#sec-finance-invest-consid">Considerations</a></li>
  <li><a href="#sec-finance-invest-6040" id="toc-sec-finance-invest-6040" class="nav-link" data-scroll-target="#sec-finance-invest-6040">60/40 Portfolio Strategy</a></li>
  <li><a href="#sec-finance-invest-momassallo" id="toc-sec-finance-invest-momassallo" class="nav-link" data-scroll-target="#sec-finance-invest-momassallo">Momentum Tactical Asset Allocation Strategy</a></li>
  <li><a href="#dual-momentum-sector-rotation" id="toc-dual-momentum-sector-rotation" class="nav-link" data-scroll-target="#dual-momentum-sector-rotation">Dual Momentum Sector Rotation</a></li>
  <li><a href="#sec-finance-invest-vtp" id="toc-sec-finance-invest-vtp" class="nav-link" data-scroll-target="#sec-finance-invest-vtp">Volatility Targeting Portfolio</a></li>
  <li><a href="#sec-finance-invest-meanrev" id="toc-sec-finance-invest-meanrev" class="nav-link" data-scroll-target="#sec-finance-invest-meanrev">Mean Reversion Strategy or Pairs Trading</a></li>
  <li><a href="#sec-finance-invest-bonds" id="toc-sec-finance-invest-bonds" class="nav-link" data-scroll-target="#sec-finance-invest-bonds">Bonds</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/finance-glossary.html">Finance</a></li><li class="breadcrumb-item"><a href="../qmd/finance-investing.html">Investing</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-finance-invest" class="quarto-section-identifier">Investing</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-finance-invest-misc" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-misc">Misc</h2>
<ul>
<li><p>Resources</p>
<ul>
<li><a href="https://www.tidy-finance.org/">Tidy Finance</a> - R and Python versions</li>
<li>Advances in Financial Machine Learning - de Prado (R &gt;&gt; Documents &gt;&gt; Financial)</li>
<li><a href="https://ml4trading.io/">Machine Learning for Algorithmic Trading</a>
<ul>
<li>Github <a href="https://github.com/stefan-jansen/machine-learning-for-trading">repo</a> with the code that’s referred to in the book</li>
</ul></li>
</ul></li>
<li><p>Packages</p>
<ul>
<li><a href="https://cran.r-project.org/web/views/Finance.html">CRAN Task View</a></li>
<li><span style="color: goldenrod">{{</span><a href="https://pypi.org/project/zipline-reloaded/" style="color: goldenrod">zipline-reloaded</a><span style="color: goldenrod">}}</span> - Backtesting and live-trading engine by crowd-sourced investment fund Quantopian</li>
<li><span style="color: goldenrod">{{</span><a href="https://pyfolio.ml4trading.io/" style="color: goldenrod">pyfolio</a><span style="color: goldenrod">}}</span> - Performance and risk analysis for financial portfolios</li>
<li><span style="color: goldenrod">{{</span><a href="https://skfolio.org/" style="color: goldenrod">skfolio</a><span style="color: goldenrod">}}</span> - Portfolio optimization built on top of scikit-learn. It offers a unified interface and tools compatible with scikit-learn to build, fine-tune, and cross-validate portfolio models.</li>
<li><span style="color: goldenrod">{{</span><a href="https://alphalens.ml4trading.io/" style="color: goldenrod">alphalens</a><span style="color: goldenrod">}}</span> - Performance analysis of predictive stock factors</li>
</ul></li>
<li><p>Tools</p>
<ul>
<li><p><a href="https://my.openbb.co/login">OpenBB</a> - Open source bloomberg terminal (overview <a href="https://www.quantscience.io/newsletter/b/how-to-get-free-financial-data">article</a>)</p>
<ul>
<li>Free data and seemingly hundreds of different tools including some decent forecast methods.</li>
</ul></li>
</ul></li>
<li><p>For portfolio construction in general, positions are optimized using Expected Returns, Return Variance (i.e.&nbsp;volatility), and Co-Movements (i.e.&nbsp;covariance) in order to maximize Risk Adjusted Returns.</p></li>
<li><p>Technical vs Fundamental Analysis</p>
<ul>
<li><em>Technical analysis</em> in many cases tends to amplify stock price trends because many technical traders buy when stocks are rising and sell when they fall.</li>
<li><em>Fundamental analysis</em> on the contrary often shows mean-reverting behaviour because its adherents try to buy undervalued stocks and sell overvalued ones</li>
</ul></li>
<li><p>Smoothers</p>
<ul>
<li>Simple Moving Average (SMA) is simple, easy to implement but reacts slowly to recent price changes due to equal weighting of all prices in the window.</li>
<li>Exponential Moving Average (EMA) reacts faster to recent price changes due to more weight to the latest prices.</li>
<li>Kalman Filter is more sophisticated and can adaptively weigh incoming measurements based on their estimated noise level, potentially providing superior results in many applications. However, it has key parameters that must be tuned to get good results.</li>
</ul></li>
<li><p>Strategies</p>
<ul>
<li>Notes from
<ul>
<li><a href="https://robotwealth.com/three-types-of-systematic-strategy-that-work/">Three types of systematic strategy that “work”</a></li>
</ul></li>
<li>Hedgefund - factor rotations (longer term)</li>
<li>Something about futures - factor tilts (shorter term)</li>
<li>Harvesting Risk Premia
<ul>
<li>Should be the primary focus of independent traders.</li>
<li>General Process
<ul>
<li>Intentionally expose your portfolio to diverse <em>sources of risk that tend to be rewarded</em> (noting that not all risks are rewarded)</li>
<li>Manage risk sensibly so no risk dominates at any time</li>
<li>Be patient and chill (the hardest part for most)</li>
</ul></li>
<li>Examples: 60/40 stock/bond portfolio</li>
</ul></li>
<li>Economically-sensible, statistically-quantifiable slow-converging inefficiencies
<ul>
<li>These are noisy tendencies for assets to trade too cheap or expensive at certain times due to behavioral or structural effects. Slow to converge and must be analyzed in aggregated datasets. Generally, these edges are less reliable than risk premia harvesting.</li>
<li>After mastering Harvesting Risk Premia, add a little of this over time.</li>
<li>Requirements
<ul>
<li>To understand why the inefficiency would persist.</li>
<li>Faster converging metrics around what we’re exploiting so we’re not the last to know when the inefficiency disappears.</li>
<li>Patience and discipline to keep swinging the bat – you have to let the noisy edge play out over a large number of bets.</li>
</ul></li>
<li>Examples: Momentum effects, seasonal regularities, effects due to indexing inclusion/exclusion, probably style factors (momentum, value, carry, quality, low vol), and most medium frequency statistical arbitrage approaches.</li>
<li>Resources
<ul>
<li>Expected Returns by Antti Ilmanen</li>
<li>Efficiently Inefficient by Lasse Pedersen</li>
<li>Positional Option Trading by Euan Sinclair <em><strong>(</strong>which literally gives you stuff to trade<strong>)</strong></em></li>
<li>Active Portfolio Managementby Grinhold and Kahn</li>
</ul></li>
</ul></li>
<li>Fast-converging supply-demand imbalances
<ul>
<li>Short term supply and demand imbalances create dislocations in prices which fast traders can “disperse” by trading against them and offsetting risk elsewhere. It carries risks because we can’t trade instantaneously.</li>
<li>Require significant investment in infrastructure and staff, so isn’t practical for “home gamers.”</li>
<li>Examples
<ul>
<li>Arbitrage: Buy futures on Shanghai INE and buy a similar contract cheaper on Singapore SGX for a profit (after costs).</li>
</ul></li>
</ul></li>
</ul></li>
<li><p>Misleading chart (<a href="https://twitter.com/choffstein/status/1640034865817985024">Thread</a>)<br>
<a href="./_resources/Finance.resources/image.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="./_resources/Finance.resources/image.png" class="img-fluid" width="448"></a><br>
</p>
<ul>
<li>No transaction costs</li>
<li>No fees</li>
<li>No taxes</li>
<li>US “exceptionalism”</li>
<li>Overlapping time period analysis
<ul>
<li>Example: if I look at 1920-1950 and then 1921-1951, twenty eight of the thirty data points are overlapping. So there’s not a lot of “unique” data in this set.</li>
</ul></li>
<li>Nominal vs real returns - Time weighted vs dollar weighted returns</li>
</ul></li>
<li><p>Workflow</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="_resources/Finance.resources/ml4t_workflow-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2" title="From Machine Learning for Algorithmic Trading"><img src="_resources/Finance.resources/ml4t_workflow-1.png" class="img-fluid figure-img" width="532" alt="From Machine Learning for Algorithmic Trading"></a></p>
<figcaption>From Machine Learning for Algorithmic Trading</figcaption>
</figure>
</div></li>
<li><p>Any market forecasting model, especially involving short term horizons, should probably have a random walk in an ensemble. (<a href="https://www.deanmarchiori.com/posts/2024-01-04-randomshares/">Is the Market Just Random Noise?</a>)</p></li>
</ul>
</section>
<section id="sec-finance-invest-consid" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-consid">Considerations</h2>
<ul>
<li>Costs that need to be accounted for when backtesting
<ul>
<li>Transaction costs</li>
<li>Fees</li>
<li>Slippage</li>
<li>Taxes</li>
</ul></li>
<li>A model that performs well in a specific market condition may incur substantial losses when the market shifts, be it due to news, events, or economic changes.
<ul>
<li>See <a href="../qmd/finance-snippets.html#sec-finance-snip-misc" style="color: green">Finance, Snippets &gt;&gt; Misc</a> &gt;&gt; Test Assumptions</li>
</ul></li>
<li>Beware of survivorship bias when backtesting algorithms
<ul>
<li>Example: S&amp;P 500
<ul>
<li>A trader is creating an algorithm to predict prices of all the stocks in the S&amp;P 500. If the trader uses the current roster of companies, the list only includes companies that have made it to now without shutting down or losing so much value they drop off the list. The trader should use the list of companies as it was at the start of the training data.</li>
</ul></li>
</ul></li>
<li>Use proper stop-loss and position sizing strategies to manage risk</li>
<li>Iteratively using the <em>same</em> data to design and modify a strategy can lead to overfitting, where the strategy becomes overly tailored to the data and performs poorly in real-world trading.</li>
<li>Ignorance of macro-economic indicators and trends can result in unexpected market moves, significantly impacting algorithmic strategies and their performance.\</li>
<li>There are 435 choices for start and end dates of each monthly investment cycle
<ul>
<li>i.e.&nbsp;Easy to have a selective endpoints fallacy for an investment strategy.</li>
</ul></li>
</ul>
</section>
<section id="sec-finance-invest-6040" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-6040">60/40 Portfolio Strategy</h2>
<ul>
<li>Misc
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://www.quantstart.com/qstrader/tutorial-60-40-portfolio/" style="color: goldenrod">QSTrader</a><span style="color: goldenrod">}}</span></li>
<li>Notes from - <a href="https://www.quantstart.com/articles/the-6040-benchmark-portfolio/">The 60/40 Benchmark Portfolio</a></li>
</ul></li>
<li>Description
<ul>
<li>60/40 US Equities/Bonds strategy is a simple long-term investment approach that is widely utilised in the investment industry. It seeks to ensure that at any point during the lifetime of the investment that 60% of account equity is invested in one or more assets representing a broad selection of US equities (such as an S&amp;P500 ETF), while 40% of account equity is invested in one or more assets representing a broad selection of US treasury bonds (such as a treasury bond ETF).</li>
<li>Since the actual percentage allocations of each asset class can deviate over time due to relative growth of the respective assets a ‘rebalance’ approach is often carried out. This means that trades are issued on a relatively infrequent basis to buy/sell amounts of each asset class to periodically bring the account equity allocations back into the 60/40 split. For the particular strategy implemented here we are using an end of month rebalance frequency.</li>
</ul></li>
<li>More balanced implementations include&nbsp;<a href="https://www.bridgewater.com/research-and-insights/the-all-weather-story">Bridgewater’s All-Weather</a>&nbsp;portfolio and Risk Parity strategies generally, which attempt to equalize risk across assets or sources of risk premia.</li>
</ul>
</section>
<section id="sec-finance-invest-momassallo" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-momassallo">Momentum Tactical Asset Allocation Strategy</h2>
<ul>
<li>Misc
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://www.quantstart.com/qstrader/tutorial-60-40-portfolio/" style="color: goldenrod">QSTrader</a><span style="color: goldenrod">}}</span></li>
<li>Notes from
<ul>
<li><a href="https://www.quantstart.com/articles/systematic-tactical-asset-allocation-an-introduction/">Systematic Tactical Asset Allocation: An Introduction</a> - <a href="https://www.quantstart.com/qstrader/tutorial-momentum-tactical-asset-allocation-strategy/">Tutorial</a></li>
</ul></li>
</ul></li>
<li>Description
<ul>
<li>The US sector momentum strategy is a long-only dynamic tactical asset allocation strategy that attempts to exceed the performance of simply going long the S&amp;P500.</li>
<li>At the end of every month the strategy calculates the holding period return (HPR) based momentum of all of the SPDR sector ETFs (the ticker symbols of which begin with the prefix XL) and selects the top N to invest in for the forthcoming month, where N is usually between 3 and 6.</li>
<li>In the implementation given here the HPR momentum is calculated over the previous 126 days (approximately six months of business days) and the top three sector ETFs are chosen for the portfolio.</li>
<li>The portfolio allocation is equally weighted between each of these three sector ETFs. Irrespective of changes in signal the portfolio is rebalanced once per month to weight the assets equally.</li>
</ul></li>
</ul>
</section>
<section id="dual-momentum-sector-rotation" class="level2">
<h2 class="anchored" data-anchor-id="dual-momentum-sector-rotation">Dual Momentum Sector Rotation</h2>
<ul>
<li>Notes from <a href="https://nlxfinance.wordpress.com/2023/11/22/simulation-of-gary-antonaccis-dual-momentum-sector-rotation-strategy/">Simulation of Gary Antonacci’s Dual Momentum Sector Rotation&nbsp;Strategy</a></li>
<li>Characteristics
<ul>
<li>Conditions for investing offensively or defensively: the 12-month momentum of the S&amp;P500 (absolute mom)</li>
<li>List of offensive investment vehicles: the 11 sectors that make up the S&amp;P500 index (relative strength)</li>
<li>Number of sectors to be selected when the strategy is invested offensively: 4</li>
<li>Sector selection criteria: 12-month momentum</li>
<li>List of defensive investment vehicles: US Aggregate Global Bond or Money Market (Cash)</li>
<li>Number of instruments to be selected when the strategy is invested defensively: 1</li>
</ul></li>
<li>Process
<ul>
<li>12-month momentum of the S&amp;P500 used to decide whether the market is in an uptrend or a downtrend, i.e.&nbsp;to invest offensively or defensively.</li>
<li>If the S&amp;P500 is in an uptrend, invest offensively. In this case, the allocation is spread evenly over the 4 sectors with the highest 12-month momentum, 25% each.
<ul>
<li>If fewer than 4 sectors have positive momentum, then the remainder not invested offensively is allocated to a defensive position.</li>
</ul></li>
<li>If the S&amp;P500 is trending downwards (negative momentum), I invest defensively. In this case, I allocate the entire portfolio to US government bonds or the money market, depending on which market has offered the highest returns over the last 12 months.
<ul>
<li>Those familiar with the GEM strategy will note that the author initially recommended using only US government bonds as a defensive asset. However, since interest rates have fallen so much over the last 10 years, since the publication of his study, it now seems more reasonable to compare the US government bond market with the performance of the money market, in order to select the market that offers the best risk/return trade-off.</li>
</ul></li>
<li>Calculate 12-month momentum: ( Price at the end of the month – Price 12 months ago ) / ( Price 12 months ago )</li>
<li>Momentum calculations and any arbitrages are carried out at the end of each month.</li>
</ul></li>
<li>Comparison
<ul>
<li>Cumulative Performance: DMSR vs.&nbsp;SPY vs.&nbsp;GEM<br>
<a href="_resources/Finance.resources/dmsr-spy-gem-comp-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="_resources/Finance.resources/dmsr-spy-gem-comp-1.png" class="img-fluid" width="532"></a>
<ul>
<li>Simple Cumulative Performance (%) is computed every month (I think)
<ul>
<li>Rate of Return<br>
<span class="math display">\[
\text{RoR} = \frac{\text{Ending Value} - \text{Starting Value}}{\text{Starting Value}} \times 100
\]</span></li>
<li>Cumulative Performance (CP)<br>
<span class="math display">\[
\text{CP} = (1 + \text{RoR}_1) \times (1 + \text{RoR}_2) \times \cdots \times (1 + \text{RoR}_n) - 1
\]</span></li>
</ul></li>
</ul></li>
<li>Statistics<br>
<a href="_resources/Finance.resources/dmsr-spy-gem-stats-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="_resources/Finance.resources/dmsr-spy-gem-stats-1.png" class="img-fluid" width="532"></a></li>
</ul></li>
</ul>
</section>
<section id="sec-finance-invest-vtp" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-vtp">Volatility Targeting Portfolio</h2>
<ul>
<li>Misc
<ul>
<li>The Impact of Volatility Targeting (<a href="https://www.man.com/maninstitute/the-impact-of-volatility-targeting#:~:text=Volatility%20targeting%20seeks%20to%20counter%20the%20fluctuations%20in%20volatility%3A,than%20a%20constant%20notional%20exposure.">paper</a>)</li>
<li>Quant Science <a href="https://www.quantscience.io/newsletter/b/automating-trades-interactive-brokers-and-python?ck_subscriber_id=2259292279">article</a> uses {{riskfolio}} to generate volatility weights for equities. (<a href="https://github.com/quant-science/sunday-quant-scientist/blob/main/QS002-automate-trades/automate-trades.py?ck_subscriber_id=2259292279">code</a>)
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://riskfolio-lib.readthedocs.io/en/latest/index.html" style="color: goldenrod">riskfolio</a><span style="color: goldenrod">}}</span> - Good docs with plenty of examples</li>
</ul></li>
</ul></li>
<li>Volatility targeting seeks to counter the fluctuations in volatility:
<ul>
<li>It leads to leveraging a portfolio at times of low volatility, and scaling down exposures at times of high volatility.</li>
<li>This approach targets a constant level of volatility, rather than a constant notional exposure.</li>
</ul></li>
<li>Volatility clustering is a key feature of financial asset returns:
<ul>
<li>High volatility over the recent past tends to be followed by high volatility in the near future.</li>
</ul></li>
<li>Impact on Sharpe ratio
<ul>
<li>Volatility targeting improves the Sharpe ratio of “risk assets” (equities and credit), and that of “balanced” and “risk parity” portfolios that have a substantial allocation to these risk assets.</li>
<li>For equity and credit, volatility targeting effectively introduces some momentum overlay due to the so-called leverage effect: the negative relationship between returns and changes in volatility.</li>
<li>In contrast, for bonds, currencies, and commodities the impact on the Sharpe ratio is negligible.</li>
</ul></li>
<li>Impact on likelihood of tail events
<ul>
<li>Volatility targeting reduces the likelihood of extreme returns for all asset classes.</li>
<li>Importantly, “left-tail” events tend to be less severe, as they typically occur at times of elevated volatility, when a target-volatility portfolio has a scaled-down notional exposure.</li>
</ul></li>
</ul>
</section>
<section id="sec-finance-invest-meanrev" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-meanrev">Mean Reversion Strategy or Pairs Trading</h2>
<ul>
<li>Papers
<ul>
<li><a href="https://arxiv.org/abs/2403.07998">Pairs Trading Using a Novel Graphical Matching Approach</a>
<ul>
<li>Application of graph theory to the selection of stock pairs. Results in robust risk-adjusted performance but also achieves annualized returns comparable to the S&amp;P 500 with a superior Sharpe ratio
<ul>
<li>Selection based <em>solely</em> upon the significance of cointegration between pairs can result in portfolios overly concentrated in a limited number of stocks, which elevates portfolio variance and diminishes risk-adjusted returns</li>
</ul></li>
<li>Utilizes of graph theory to the selection of stock pairs to decrease variance with the t-statistic from a cointegration statistical test as the weight for the edges.</li>
</ul></li>
</ul></li>
<li>Match two trading vehicles that are highly correlated, trading one long and the other short when the pair’s price ratio diverges “x” number of standard deviations - “x” is optimized using historical data. If the pair reverts to its mean trend, a profit is made on one or both of the positions.</li>
<li>Chart the relative performance (price ratio)
<ul>
<li>The center white line represents the mean price ratio over the past two years. The yellow and red lines represent one and two standard deviations from the mean ratio, respectively.</li>
<li>The potential for profit can be identified when the price ratio hits its first or second deviation. When these profitable divergences occur it is time to take a long position in the underperformer and a short position in the overachiever. (i.e.&nbsp;shorting the stock that’s rising in relation to the other, and buying the other stock that hasn’t risen yet)</li>
<li>The revenue from the short sale can help cover the cost of the long position, making the pairs trade inexpensive to put on.</li>
<li>Position size of the pair should be matched by dollar value rather than number of shares; this way a 5% move in one equals a 5% move in the other.</li>
<li>As with all investments, there is a risk that the trades could move into the red, so it is important to determine optimized stop-loss points before implementing the pairs trade.</li>
</ul></li>
<li>Chart the spreads between returns</li>
<li>Look for stocks that move closely together and their:
<ul>
<li>Spreads zig-zag around zero</li>
<li>Prices separately (marginally) are normally distributed and joint-normally distributed (assumes linear correlation)
<ul>
<li>If both, then they move up AND down together (symmetric)</li>
<li>If only marginally, then they probably only move in one direction together (asymmetric)</li>
</ul></li>
</ul></li>
<li>If your two assets returns (differenced prices are stationary) do not correlate within a [0.7..0.8] correlation coefficient range at least 70% of the times (70% of all observations) then you’re probably dealing with a very bad hedging instrument
<ul>
<li>Look to cover the remaining data points and research why correlations broke down during those periods. If you can derive a mathematical relationship you could possibly formulate an approach in which you make adjustments to the hedge ratio through an adjustment in your beta/correlation coefficient.</li>
<li>Figure out the optimal time interval to retrain model due to data drift</li>
<li>Rolling 20-day correlation is a common way to monitor stock correlation</li>
</ul></li>
<li>Beware of two correlated stocks that have similar Beta or some other confounding variable
<ul>
<li>Graphical LASSO can help remove effects such as market Beta and recover real, direct relationships between stocks.
<ul>
<li>It makes intuitive sense that in a large universe, most stocks would be conditionally independent, and Graphical LASSO is able to refine this sparsity condition by tuning it’s only parameter</li>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/association-general.html#sec-assoc-gen-partcor" style="color: green">Association, General &gt;&gt; Partial Correlation</a> for a stock example</li>
</ul></li>
</ul></li>
<li>Copulas
<ul>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/association-copulas.html#sec-assoc-cop" style="color: green">Association, Copulas</a></li>
<li>Measures non-linear association</li>
<li>For Value-at-Risk (VAR) calculations, Gaussian copula is overly optimistic and Gumbel is too pessimistic</li>
<li>Copulas with upper tail dependence: Gumbel, Joe, N13, N14, Student-t.</li>
<li>Copulas with lower tail dependence: Clayton, N14 (weaker than upper tail), Student-t.</li>
<li>Copulas with no tail dependence: Gaussian, Frank.</li>
</ul></li>
<li>Cointegration allows us to construct a stationary time series from two asset price series, if only we can find the magic weight, or more formally, the cointegration coefficient β. Then we can apply a mean-reversion strategy to trade both assets at the same time weighted by β. There is no guarantee that such β always exists, and you should look for other asset pairs if no such β can be found.
<ul>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/forecasting-statistical.html#sec-fcast-stat-terms" style="color: green">Forecasting, Statistical &gt;&gt; Terms</a></li>
<li>Cointegrated assets share common nonstationary components, which may include trend, seasonal, and stochastic parts</li>
<li>Might have low correlation, and highly correlated series might not be cointegrated at all.</li>
<li>Describes a long-term relationship between the prices (correlation describes a short-term relationship between the returns). The resulting stationary series is the spread between the prices of both assets</li>
<li>Should have similar risk exposure so that their prices move together</li>
<li>Good candidates for cointegrated pairs could be:
<ul>
<li>Stocks that belong to the same sector.</li>
<li>WTI crude oil and Brent crude oil.</li>
<li>AUD/USD and NZD/USD.</li>
<li>Yield curves and futures calendar spreads</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-finance-invest-bonds" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-invest-bonds">Bonds</h2>
<ul>
<li>Misc
<ul>
<li>Resources
<ul>
<li><a href="https://www.nerdwallet.com/calculator/compound-interest-calculator?trk=nw_gn_5.0">NerdWallet Compound Interest Calculator</a>
<ul>
<li><span class="ribbon-highlight">Example</span>: if you put $5,000 in a (5yr) bond with a 4% yield, assuming you reinvest your interest payments, you will have $6083 by the time it matures.<br>
<a href="_resources/Finance.resources/nerdwallet-compound-interest-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="_resources/Finance.resources/nerdwallet-compound-interest-1.png" class="img-fluid" width="432"></a></li>
</ul></li>
</ul></li>
<li>Notes from
<ul>
<li><a href="https://www.wsj.com/finance/investing/investing-bonds-what-to-know-98e6f138?mod=e2twg">It’s a Good Time to Buy Bonds. Just Know What You’re Getting Into.</a></li>
</ul></li>
<li>The price of a bond moves in the opposite direction to interest rates.
<ul>
<li>As rates rise, the value of older bonds with lower coupons declines.&nbsp;</li>
</ul></li>
<li>Most often, people will compare the 2-year Treasury with the 10-year. So, any generic mention of the spread, in a bond context, refers to the difference in yield between these two bonds.</li>
<li>Bond traders buy existing bonds in the secondary bond market, and sell them at a discount to their face value.
<ul>
<li>The amount of the discount depends partially on how many payments are still due before the bond reaches maturity.</li>
<li>The price also is a bet on the direction of interest rates. If a trader thinks interest rates on new bond issues will be lower, the existing bonds may be worth a little more.</li>
</ul></li>
<li>Zero-Coupon Bonds (aka Discount Bonds)
<ul>
<li>Owners receive no payments for their money until the bond has matured.</li>
<li>They buy the bond for an amount that is less than its face value. When it reaches its maturity, they are paid the full face value of the bond.</li>
<li>Most zero-coupon bonds have a pre-set face value and therefore pay a pre-set amount of money at maturity.
<ul>
<li>Some bonds are inflation-indexed, meaning the face value is determined at maturity. The amount paid will be based on a standard measure such as the consumer price index plus a premium.</li>
</ul></li>
<li>Considered short-term investments that typically have a maturity of no more than one year. These short-term bonds are usually called <strong>bills</strong>.</li>
</ul></li>
</ul></li>
<li>Questions
<ul>
<li>Should you buy the highest-yielding bonds, or is it better to lock in good rates for longer?</li>
<li>Is it better to buy bonds directly from the government, a brokerage or as part of a bond fund?</li>
<li>How much do I make on bonds after taxes and fees?</li>
<li>How many bonds should I buy?</li>
</ul></li>
<li>Short-Term Bonds (e.g.&nbsp;2-year Treasury)
<ul>
<li>Pros:
<ul>
<li>Higher yields (i.e.&nbsp;return) than long term bonds (e.g.&nbsp;10-year Treasury)</li>
</ul></li>
<li>Cons:
<ul>
<li>When interest rates are high, you lose the opportunity (i.e.&nbsp;by not buying longer term bonds) to lock in a potentially higher return for longer should rates drop in the future.</li>
</ul></li>
</ul></li>
<li>Bond Ladder
<ul>
<li>Divide your investments among bonds with progressively later maturity dates.
<ul>
<li>Investors should also choose bonds based on savings goals and how soon they will need the money</li>
</ul></li>
<li>This takes advantage of both higher short term coupons and longer term yields.</li>
</ul></li>
<li>Considerations
<ul>
<li>Check a bond’s credit ratings before you buy. A poor rating means the bond issuer, such as a corporation, is less likely to pay you back.
<ul>
<li>This can be enticing because the issuer will likely offer you a higher interest rate. It also means they are more likely to default, which would mean you lose money.</li>
</ul></li>
<li>Watch out for hidden expenses like markup fees for purchasing an individual bond
<ul>
<li>Can be anywhere from 1% to 5%, depending on the broker.</li>
</ul></li>
<li>You are often not buying directly from the issuer. Instead, you are buying from another investor and the price of that bond probably has shifted since it was initially issued.
<ul>
<li>One advantage of using a brokerage is that their sites will take the guesswork out of how much the change in the market price of your bond will affect your final return.</li>
</ul></li>
<li>Taxes
<ul>
<li>CD interest, which may at time near bond yields, is taxed as ordinary income, as high as 37%.</li>
<li>The interest on Treasurys is exempt from state taxes.</li>
<li>Municipal bonds are exempt from both state and local taxes if an investor buys the bond from the same state they live in.</li>
<li>Corporate bonds have no tax benefits, so investors still need to pay both state and federal taxes on them.</li>
<li>Bonds within a tax-sheltered account like a 401(k) or an IRA aren’t taxed until you withdraw the money</li>
<li>If a zero-coupon bond is issued by a U.S. local or state government entity, interest is free from federal tax and generally exempt from state and local tax as well.
<ul>
<li>Zero-Coupon bonds subject to taxation in the U.S. can be held in a tax-deferred retirement account, allowing their investors to avoid tax on future income.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Purchasing
<ul>
<li>Treasurys and most other bonds through a brokerage such as Charles Schwab, Fidelity or Vanguard.</li>
<li>Government bonds can also be bought directly from <a href="https://www.treasurydirect.gov/">TreasuryDirect</a>, a government website.</li>
<li>Bond funds and ETFs allow you to diversify your investment.
<ul>
<li>Bonds funds often don’t hold bonds until maturity.</li>
</ul></li>
</ul></li>
</ul>


<div class="hidden" aria-hidden="true">
<span class="glightbox-desc lightbox-desc-2">From Machine Learning for Algorithmic Trading</span>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/finance-glossary.html" class="pagination-link" aria-label="Glossary">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Glossary</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/finance-snippets.html" class="pagination-link" aria-label="Snippets">
        <span class="nav-page-text">Snippets</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">
<p>Creative Commons Attribution-NonCommercial 4.0 International Public License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"loop":false,"closeEffect":"zoom","selector":".lightbox","descPosition":"bottom","openEffect":"zoom"});
window.onload = () => {
  lightboxQuarto.on('slide_before_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    const href = trigger.getAttribute('href');
    if (href !== null) {
      const imgEl = window.document.querySelector(`a[href="${href}"] img`);
      if (imgEl !== null) {
        const srcAttr = imgEl.getAttribute("src");
        if (srcAttr && srcAttr.startsWith("data:")) {
          slideConfig.href = srcAttr;
        }
      }
    } 
  });

  lightboxQuarto.on('slide_after_load', (data) => {
    const { slideIndex, slideNode, slideConfig, player, trigger } = data;
    if (window.Quarto?.typesetMath) {
      window.Quarto.typesetMath(slideNode);
    }
  });

};
          </script>




</body></html>