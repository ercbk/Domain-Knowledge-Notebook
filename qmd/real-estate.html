<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Domain Knowledge - 4&nbsp; Real Estate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/retail.html" rel="next">
<link href="../qmd/product-development.html" rel="prev">
<link href="../images/dk-favicon-32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/real-estate.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Real Estate</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Domain Knowledge</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="https://github.com/ercbk/Domain-Knowledge-Notebook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/agriculture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agriculture</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/banking-credit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Banking/Credit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/budget-allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Budget Allocation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Economics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/epidemiology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Finance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/healthcare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Healthcare</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/insurance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Insurance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kpis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">KPIs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/location-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Location Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Logistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/low-hanging-fruit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Low Hanging Fruit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/manufacturing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manufacturing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/meteorology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meteorology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nonprofits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonprofits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/politics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Politics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/product-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Product Development</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/real-estate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Real Estate</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/retail.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Retail</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/saas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SaaS</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-rlest-misc" id="toc-sec-rlest-misc" class="nav-link active" data-scroll-target="#sec-rlest-misc"><span class="header-section-number">4.1</span> Misc</a></li>
  <li><a href="#sec-rlest-terms" id="toc-sec-rlest-terms" class="nav-link" data-scroll-target="#sec-rlest-terms"><span class="header-section-number">4.2</span> Terms</a></li>
  <li><a href="#sec-rlest-bizq" id="toc-sec-rlest-bizq" class="nav-link" data-scroll-target="#sec-rlest-bizq"><span class="header-section-number">4.3</span> Business Questions</a></li>
  <li><a href="#sec-rlest-usecases" id="toc-sec-rlest-usecases" class="nav-link" data-scroll-target="#sec-rlest-usecases"><span class="header-section-number">4.4</span> Use Cases</a></li>
  <li><a href="#sec-rlest-apprais" id="toc-sec-rlest-apprais" class="nav-link" data-scroll-target="#sec-rlest-apprais"><span class="header-section-number">4.5</span> Appraisal Methods (Price Estimation)</a>
  <ul>
  <li><a href="#sec-rlest-apprais-trad" id="toc-sec-rlest-apprais-trad" class="nav-link" data-scroll-target="#sec-rlest-apprais-trad"><span class="header-section-number">4.5.1</span> Traditional</a></li>
  <li><a href="#sec-rlest-apprais-ml" id="toc-sec-rlest-apprais-ml" class="nav-link" data-scroll-target="#sec-rlest-apprais-ml"><span class="header-section-number">4.5.2</span> ML Approaches</a>
  <ul class="collapse">
  <li><a href="#sec-rlest-apprais-ml-misc" id="toc-sec-rlest-apprais-ml-misc" class="nav-link" data-scroll-target="#sec-rlest-apprais-ml-misc"><span class="header-section-number">4.5.2.1</span> Misc</a></li>
  <li><a href="#sec-rlest-apprais-ml-feats" id="toc-sec-rlest-apprais-ml-feats" class="nav-link" data-scroll-target="#sec-rlest-apprais-ml-feats"><span class="header-section-number">4.5.2.2</span> Features</a></li>
  <li><a href="#sec-rlest-apprais-ml-hedpric" id="toc-sec-rlest-apprais-ml-hedpric" class="nav-link" data-scroll-target="#sec-rlest-apprais-ml-hedpric"><span class="header-section-number">4.5.2.3</span> Hedonic Pricing Method</a></li>
  <li><a href="#sec-rlest-apprais-ml-cmaprc" id="toc-sec-rlest-apprais-ml-cmaprc" class="nav-link" data-scroll-target="#sec-rlest-apprais-ml-cmaprc"><span class="header-section-number">4.5.2.4</span> CMA with Comp Price Adjustments</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-rlest-feats" id="toc-sec-rlest-feats" class="nav-link" data-scroll-target="#sec-rlest-feats"><span class="header-section-number">4.6</span> Features</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-rlest" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Real Estate</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="sec-rlest-misc" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-rlest-misc"><span class="header-section-number">4.1</span> Misc</h2>
<ul>
<li>Listing Price
<ul>
<li>Affects the final selling price, how long the home spends on the market, the volume of interest in the house, and anchors price negotiations with buyers</li>
<li>Algorithmic estimates have better performances when they take the list price into account</li>
</ul></li>
<li>A home has a value distribution as different potential buyers place different values on the various home features. The eventual selling price is a function of this value distribution and the specific individuals who consider the home.</li>
<li>Price/Income ratio
<ul>
<li><span class="ribbon-highlight">Example</span>: Median house price in middle class suburbia in a very affordable region is $323,000. To maintain an price/income ratio of 3, that requires a household income of $107,000. In 2019, regional median HH income was $62,502. ~30% of HH make over $100K.</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-terms" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-rlest-terms"><span class="header-section-number">4.2</span> Terms</h2>
<ul>
<li><span style="color: #009499"><strong>Price Anchoring</strong></span> - a pricing strategy that plays on buyers’ inherent tendency to rely heavily on a piece of initial information to guide subsequent decisions. In the context of pricing, many businesses will set a visible initial price for a product but make a point of showing that it’s now being sold at a discount.</li>
<li><span style="color: #009499"><strong>Price Index</strong></span> - a normalized average (typically a weighted average) of price relatives for a given class of goods or services in a given region, during a given interval of time
<ul>
<li><a href="https://fred.stlouisfed.org/series/CSUSHPISA">Case-Shiller U.S. National Home Price Index</a> (also {fredr})</li>
<li><a href="https://en.wikipedia.org/wiki/Price_index">Wiki</a> has formulas</li>
<li>See Appraisal Methods &gt;&gt; Prediction Adjustments &gt;&gt; Repeat Sales Model</li>
<li>If a price index rises 10%, it means the average level of prices has risen 10%</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-bizq" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-rlest-bizq"><span class="header-section-number">4.3</span> Business Questions</h2>
<ul>
<li>Agent
<ul>
<li>Which house should I buy or build to maximize my return?</li>
<li>Where or when should I do so?</li>
<li>What is its optimum rent or sale price?</li>
</ul></li>
<li>Buyer
<ul>
<li>Match them with agent</li>
<li>find them a home</li>
<li>appropriate mortgage</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-usecases" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="sec-rlest-usecases"><span class="header-section-number">4.4</span> Use Cases</h2>
<ul>
<li>Using computer vision and NLP to enhance searches
<ul>
<li>Incorporating image search capabilities: extract information from pictures of the property utilizing object detection and image classification techniques, to be used in search matching.</li>
<li>Recommendation-engine-powered rankings: search results could be ranked according to the likelihood that the specific user will interact with the results, based on previous searches, profile characteristics, and contextual information.</li>
<li>Search intent matching: enhance the user experience by adding the ability to write (or dictate) their home preference(s) instead of manually filtering the results. It may be very wise to incorporate such a feature given the rise of home assistants.</li>
<li>Visual search: perform a search based purely on images of homes. This would enhance the search experience or complement the keyword search and produce more accurate and useful results.</li>
</ul></li>
<li>Identify homeowners who are more likely to sell and estimate their selling price using publicly available data</li>
<li>Find correlations between past sellers and current homeowners, in order to help predict the likelihood that a given owner is willing to sell.</li>
<li>Estimate appropriate selling price point and the interest of possible future owners so as to increase the chances of successful outreaches.</li>
<li>Lead classification:
<ul>
<li>Based on web-based actions executed by a user, understand where they are at in the customer journey and gather accurate information to move them to the next stage in the funnel.</li>
</ul></li>
<li>Risk assessment:
<ul>
<li>Multiple risks should be considered when assessing a real estate transaction. Forecasting models powered by machine learning could complement a traditional risk analysis approach well, especially given their multiple data source analysis capabilities.</li>
</ul></li>
<li>Home valuation:
<ul>
<li>A classic, yet constantly evolving, machine learning task is to set the price of a house based on MLS and alternative data (e.g.&nbsp;satellite imagery). The big iBuyers are all betting heavily on this since it’s key to their business model. An example of the level of detail obtainable is that of how Opendoor analyzed the impact of busy roads in their property valuation model.</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-apprais" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sec-rlest-apprais"><span class="header-section-number">4.5</span> Appraisal Methods (Price Estimation)</h2>
<section id="sec-rlest-apprais-trad" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="sec-rlest-apprais-trad"><span class="header-section-number">4.5.1</span> Traditional</h3>
<ul>
<li>Comparative Market Analysis (CMA)
<ul>
<li>a collection of recently sold “comparable” homes (“comps”) that, taken in aggregate, can provide a view on the value distribution of the appraised home (the “subject” home)</li>
<li>selecting similar properties (in terms of attributes and location) and inferring the target value from the comparables</li>
</ul></li>
<li>Cost Approach
<ul>
<li>The “replacement cost” is determined by totaling values such as the value of raw land (again, using comparison), the cost of rebuilding a new building that could perform the function of the existing property, and then making necessary adjustments (e.g., deprecation of the existing building).</li>
</ul></li>
<li>Profits Method (or income approach)
<ul>
<li>estimates the value of the property based on the income it generates. The value is linked to the business carried out within that property. For example, the market value of a hotel depends on the potential cash flow derived from ownership.</li>
</ul></li>
<li>Repeat sales method
<ul>
<li>analysis is restricted to just comparing price changes on properties sold more than once</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-apprais-ml" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="sec-rlest-apprais-ml"><span class="header-section-number">4.5.2</span> ML Approaches</h3>
<section id="sec-rlest-apprais-ml-misc" class="level4" data-number="4.5.2.1">
<h4 data-number="4.5.2.1" class="anchored" data-anchor-id="sec-rlest-apprais-ml-misc"><span class="header-section-number">4.5.2.1</span> Misc</h4>
<ul>
<li>Automated Valuation Models (also known as AVMs) were found to have an absolute error below 4% for homes and below 6% for commercial properties, which is much less than the error rates of traditional appraisals.</li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-feats" class="level4" data-number="4.5.2.2">
<h4 data-number="4.5.2.2" class="anchored" data-anchor-id="sec-rlest-apprais-ml-feats"><span class="header-section-number">4.5.2.2</span> Features</h4>
<ul>
<li>Different predictors may be more valuable for each of the price models.
<ul>
<li>Sale price: Zillow and Redfin use their own algorithms for real estate price estimation.</li>
<li>Rental price: HomeUnion developed a tool called RENTestimate for this.</li>
<li>Temporary rental price: Airbnb’s pricing tips use a mathematical model that learns how likely a guest is to book a specific listing, on specific dates, at a range of different prices.</li>
</ul></li>
<li>Adding nontraditional data sources can improve estimates<br>
<img src="./_resources/Real_Estate.resources/nontraditional-data.png" class="img-fluid"></li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-hedpric" class="level4" data-number="4.5.2.3">
<h4 data-number="4.5.2.3" class="anchored" data-anchor-id="sec-rlest-apprais-ml-hedpric"><span class="header-section-number">4.5.2.3</span> Hedonic Pricing Method</h4>
<ul>
<li>A typical regression that accounts for property features such as size, number of rooms, property age, home quality characteristics (granite countertops, air conditioning, pool, etc.), and location</li>
<li>{hpiR} (<a href="https://cran.r-project.org/web/packages/hpiR/vignettes/introduction.html">vignette</a>)</li>
<li>It’s just multivariable regression where log sale price (or ppsf, etc.) is the outcome and includes house characteristics and has dummy variables for the years (or days, weeks, etc.) when the house was sold</li>
<li>The exponential of the coefficients of the year dummy variables are the index and they represent the average change in the outcome variable from the reference year to the year represented by the dummy variable
<ul>
<li>1 is the index of the reference year</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-cmaprc" class="level4" data-number="4.5.2.4">
<h4 data-number="4.5.2.4" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc"><span class="header-section-number">4.5.2.4</span> CMA with Comp Price Adjustments</h4>
<section id="sec-rlest-apprais-ml-cmaprc-proc" class="level5" data-number="4.5.2.4.1">
<h5 data-number="4.5.2.4.1" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc-proc"><span class="header-section-number">4.5.2.4.1</span> Process</h5>
<ul>
<li>Data Scientist role
<ul>
<li>Suggests good comparable properties for a CMA</li>
<li>Highlights the important differences between the comparable and the subject property (the fewer, the better)</li>
<li>Suggests pricing adjustments for the differences</li>
</ul></li>
<li>Real Estate Agent
<ul>
<li>Selects which properties to use as comps</li>
<li>Selects which adjustments are relevant and appropriate for their CMA report</li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-cmaprc-misc" class="level5" data-number="4.5.2.4.2">
<h5 data-number="4.5.2.4.2" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc-misc"><span class="header-section-number">4.5.2.4.2</span> Misc</h5>
<ul>
<li>Notes from
<ul>
<li><a href="https://medium.com/compass-true-north/pricing-homes-like-agents-do-ai-for-real-estate-cma-adjustments-c3de27a7ef">Pricing Homes like Agents Do: AI for Real Estate CMA Adjustments</a></li>
</ul></li>
<li>All models of adjustments seem to use Price per Square Foot (PPSF) for a local area as the outcome variable</li>
<li>Probably want to go as small an area as you can depending on the amount of training data at that resolution</li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-cmaprc-marprc" class="level5" data-number="4.5.2.4.3">
<h5 data-number="4.5.2.4.3" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc-marprc"><span class="header-section-number">4.5.2.4.3</span> Market Price</h5>
<ul>
<li><p>Using the repeat sales model, we estimate how the price-per-square-foot evolved for each locality. Then we can use the model to estimate the difference in average price per square foot (PPSF) in the locality across any two-time points.</p></li>
<li><p>If a price index rises 10%, it means the average level of prices has risen 10%</p>
<ul>
<li><span class="ribbon-highlight">Example</span>:
<ul>
<li>CMA model produces a comp that sold for $1,100,000 almost a year ago in April 2019</li>
<li>Repeated Sales model’s indexes say that property prices have decreased by 4.6% in area since the sale of this comp.</li>
<li>Thus, to make this comp comparable now, we would need to subtract $51K (1,100,000 * 0.046 = 50,600) from the price it sold for back in April 2019.</li>
</ul></li>
</ul></li>
<li><p>In this description and the examples, I’m using sale price, but the same methods can be applied to PPSF.</p></li>
<li><p>The data is house id, year sold, sale price</p>
<ul>
<li>There will be repeated measures because each house will need to have been sold multiple times.
<ul>
<li>Maybe can this be fudged a bit by using really good comps for the repeated measures</li>
</ul></li>
<li>Only the data from the 1st and last sales are used</li>
<li>The first year in the sample data is NOT included as a variable in the regression
<ul>
<li>This is the reference or base year. This year automatically gets an index of 1.</li>
</ul></li>
</ul></li>
<li><p>Assumes homeoskedacity</p></li>
<li><p>Specification</p>
<ul>
<li>log(last_sale_price / first_sale_price) = β1 * I(year_1) + β2 * I(year_2)&nbsp; + …</li>
<li>where I(year_*) is an indicator variable with values of
<ul>
<li>1 for year of last sale</li>
<li>-1 for year of first sale</li>
<li>0 for years where the house wasn’t sold</li>
<li>“*” is the year of the sale of the house.</li>
</ul></li>
<li>Note that there is no intercept so will need <code>0 +</code> in the formula</li>
<li>exp(β*) gives the index for that year Index for the first year of the sample data is automatically set to 1.</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="at">y =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.182</span>, <span class="fl">0.041</span>, <span class="fl">0.039</span>), <span class="dv">3</span>),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="at">year =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"2013"</span>, <span class="st">"2014"</span>, <span class="st">"2015"</span>), <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="at">value =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span>&nbsp;</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>&nbsp; tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> value, <span class="at">names_prefix =</span> <span class="st">"Y"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; y Y2013 Y2014 Y2015</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="sc">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="fl">0.182</span>&nbsp; &nbsp; <span class="sc">-</span>1&nbsp; &nbsp; 0&nbsp; &nbsp; <span class="dv">1</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="fl">0.041</span>&nbsp; &nbsp; <span class="sc">-</span>1&nbsp; &nbsp; 1&nbsp; &nbsp; <span class="dv">0</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="fl">0.039</span>&nbsp; &nbsp; 0&nbsp; &nbsp; <span class="sc">-</span>1&nbsp; &nbsp; <span class="dv">1</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> Y2014 <span class="sc">+</span> Y2015, <span class="at">data =</span> dat)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>Y2014&nbsp; <span class="fl">0.07500</span>&nbsp; &nbsp; <span class="fl">0.04808</span>&nbsp; <span class="fl">1.560</span>&nbsp; &nbsp; <span class="fl">0.363</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>Y2015&nbsp; <span class="fl">0.14800</span>&nbsp; &nbsp; <span class="fl">0.04808</span>&nbsp; <span class="fl">3.078</span>&nbsp; &nbsp; <span class="fl">0.200</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(mod))</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>&nbsp; Y2014&nbsp; &nbsp; Y2015&nbsp;</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fl">1.077884</span> <span class="fl">1.159513</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>“y” is the log of the sales price ratio</li>
<li>Indexes:
<ul>
<li>2013: 1</li>
<li>2014: 1.08</li>
<li>2015: 1.16</li>
</ul></li>
</ul></li>
<li><p>Case-Shiller Method</p>
<ul>
<li><p>Handles heteroskedasticity by Weighted Least Squares</p></li>
<li><p>Typically follows the same trend (highly correlated) as the regular repeated sales model but on a lower level</p></li>
<li><p>Packages</p>
<ul>
<li>{hpiR}(<a href="https://cran.r-project.org/web/packages/hpiR/vignettes/introduction.html">vignette</a>)
<ul>
<li>Multiple modeling options, including weighted regression, robust regression, random forest</li>
<li>Also splits up houses with more than 2 sales into combinations of binary periods</li>
<li>*Doesn’t sqrt the residuals in the weighted regression like I think the original paper recommends*</li>
</ul></li>
</ul></li>
<li><p>Process</p>
<ul>
<li>First fit the repeated sales model:
<ul>
<li>log(last_sale_price / first_sale_price) = β1 * I(year_1) + β2 * I(year_2)&nbsp; + …</li>
</ul></li>
<li>Regress the squared residuals on the holding period
<ul>
<li>ε2 = β0 + β1 * holding_period</li>
<li>Holding Period: the period between the first sale and last sale</li>
</ul></li>
<li>Calculate weights using fitted values
<ul>
<li>weights = 1 / sqrt(^ε2)</li>
</ul></li>
<li>Fit weighted repeated sales model</li>
</ul></li>
<li><p>Model</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(LogP <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> ., <span class="at">data =</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>HoldingPeriod))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mod_resids <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>holding_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span>&nbsp;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="fu">select</span>(HoldingPeriod) <span class="sc">%&gt;%</span>&nbsp;</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="fu">mutate</span>(<span class="at">resids_sq =</span> mod_resids<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>resids_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(resids_sq <span class="sc">~</span> HoldingPeriod, <span class="at">data =</span> holding_dat)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>resid_preds <span class="ot">&lt;-</span> <span class="fu">fitted</span>(resids_mod)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>wgts <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(resid_preds <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(resid_preds), <span class="dv">0</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>final_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(LogP <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> .,&nbsp;</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">data =</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>HoldingPeriod),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="at">weights =</span> wgts)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># indexes</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(final_mod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Holding Period: the period between the first sale and last sale</li>
<li>“LogP”: See previous model’s Specification</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-cmaprc-bldflr" class="level5" data-number="4.5.2.4.4">
<h5 data-number="4.5.2.4.4" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc-bldflr"><span class="header-section-number">4.5.2.4.4</span> Building-Floor</h5>
<ul>
<li>Higher floors in apartment building cost more</li>
<li>Adjustment varies per building but there isn’t enough training data to have a model per building
<ul>
<li>Solution: Bin apartment data by building size, then fit a model for each bin.</li>
</ul></li>
<li>Perform Market Price adjustment to prices before modeling price differences by floor</li>
</ul>
</section>
<section id="sec-rlest-apprais-ml-cmaprc-loc" class="level5" data-number="4.5.2.4.5">
<h5 data-number="4.5.2.4.5" class="anchored" data-anchor-id="sec-rlest-apprais-ml-cmaprc-loc"><span class="header-section-number">4.5.2.4.5</span> Location</h5>
<ul>
<li>Buildings are of different ages, have various contractual constraints, and offer vastly different amenities.
<ul>
<li><span class="ribbon-highlight">Example</span>: A subject propert in a very expensive building for this neighborhood. The comp property is in a building where similarly sized apartments tend to sell for lower prices. So an adjustment to the comp needs to be made.</li>
</ul></li>
<li>Spatial nearest neighbor models for ppsf.
<ul>
<li>To prepare the training data, we use the Market Price adjustment discussed already</li>
<li>packages: {nngeo}</li>
</ul></li>
</ul>
</section>
</section>
</section>
</section>
<section id="sec-rlest-feats" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="sec-rlest-feats"><span class="header-section-number">4.6</span> Features</h2>
<ul>
<li>Scrape traditional variables (from websites?)
<ul>
<li>Number of bedrooms</li>
<li>Number of bathrooms</li>
<li>Living area, square footage</li>
<li>price per square foot (PPSF)</li>
<li>Number of stories</li>
<li>Year built</li>
<li>property type (e.g.&nbsp;condo, house)</li>
<li>Furnished/not furnished</li>
<li>Fireplace/no fireplace</li>
<li>Heating/no heating</li>
<li>pool/no pool</li>
<li>garage space</li>
<li>ZIP code</li>
<li>Latitude and longitude</li>
<li>listing price of comparable homes in the area</li>
<li>sale price</li>
<li>days on the market</li>
</ul></li>
<li>Off-market data
<ul>
<li>tax assessments</li>
<li>prior sales and other publicly available records</li>
<li>Resident surveys</li>
<li>mobile phone signal patterns</li>
<li>Yelp reviews of local restaurants help identify “hyperlocal” patterns—granular trends at the city block level rather than at the city level.</li>
</ul></li>
<li>Market trends
<ul>
<li>inflation</li>
<li>seasonality in demand</li>
<li>economic shocks</li>
</ul></li>
<li>Geographic indicators
<ul>
<li><a href="https://eng.uber.com/h3/">Uber’s H3 grid system</a> instead of zip codes, etc.</li>
<li>The quality of local schools</li>
<li>Employment opportunities</li>
<li>Proximity to shopping, entertainment,&nbsp;and recreational centers</li>
<li>Sources Google Places, Yelp, or SchoolDigger</li>
</ul></li>
<li>Image data
<ul>
<li>Satellite imagery
<ul>
<li><a href="https://www.mapbox.com/maps/satellite">Mapbox’s Satellite API</a>
<ul>
<li>allows you to query any location by its latitude and longitude coordinates</li>
<li>select from 20 different zoom levels</li>
<li>50,000 free requests each month!!</li>
</ul></li>
<li>number of roads and their condition and houses with pools</li>
</ul></li>
<li>Method
<ul>
<li>Convolutional Neural Networks (CNNs) can extract visual features, revealing underlying information captured in photos</li>
<li>satellite
<ul>
<li>A classification network can distinguish between the top and bottom 15% of houses in a dataset to test this. A model achieved an outstanding 91% accuracy, using only satellite images. After interpreting the model to understand which visual patterns governed its decision process, we saw that it placed high importance on recreational areas such as parks and lakes.</li>
</ul></li>
<li>exterior frontal images and interior photos</li>
</ul></li>
<li>Features
<ul>
<li>the activeness of a street frontage</li>
<li>accessibility of the area (number of roads, condition of the roads)</li>
<li>amount of urbanization</li>
<li>proximity to parks, lakes and beaches (recreational areas)</li>
<li>amount of greenery</li>
<li>population density</li>
</ul></li>
</ul></li>
<li>NLP
<ul>
<li>Identify the most important words in a description and learn which words tend to be used to describe more expensive or affordable houses.<br>
<img src="./_resources/Real_Estate.resources/nlp-example.png" class="img-fluid"></li>
</ul></li>
<li>Sociodemographic
<ul>
<li>Misc
<ul>
<li>Which data resolution is most predictive? (e.g.&nbsp;state, county, neighborhood, etc.)</li>
<li>Official government data sources are best (consistent, unbiased, and up-to-date indicators, with the largest sample sizes)</li>
</ul></li>
<li>Median Household Income</li>
<li>Unemployment rate</li>
<li>crime rate</li>
<li>Ethnicity</li>
<li>Number of inhabitants</li>
<li>Average age</li>
<li>Poverty level</li>
<li>Source: American Community Survey (ACS) at census tract level
<ul>
<li>small subdivisions of a county (around 4,000 inhabitants on average),</li>
<li>designed to be relatively homogeneous units concerning population characteristics, economic status, and living conditions</li>
</ul></li>
<li>Total population</li>
<li>Total employed population</li>
<li>population median age</li>
<li>Median household income</li>
<li>Population with income below poverty level</li>
<li>Minority percentage</li>
<li>Vacant housing units for rent</li>
<li>Median value for all owner-occupied housing units</li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/product-development.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Product Development</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/retail.html" class="pagination-link">
        <span class="nav-page-text">Retail</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>