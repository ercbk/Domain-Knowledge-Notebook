<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Demand Planning – Domain Knowledge</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/logistics-inventory-management.html" rel="next">
<link href="../qmd/location-selection.html" rel="prev">
<link href="../images/dk-favicon-32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/logistics-demand-planning.html">Logistics</a></li><li class="breadcrumb-item"><a href="../qmd/logistics-demand-planning.html">Demand Planning</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Domain Knowledge</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house"></i></a>
    <a href="https://ercbk.github.io/Data-Science-Notebook/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-database-gear"></i></a>
    <a href="https://ercbk.github.io/Statistical-Rethinking-Notebook/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-book"></i></a>
    <a href="https://github.com/ercbk/Domain-Knowledge-Notebook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/agriculture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agriculture</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/banking-credit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Banking/Credit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/budget-allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Budget Allocation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Economics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/epidemiology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Finance</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-investing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Investing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-risk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Risk</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-snippets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Snippets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance-valuation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Valuation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/healthcare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Healthcare</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/insurance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Insurance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kpis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">KPIs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/location-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Location Selection</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Logistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-demand-planning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Demand Planning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-inventory-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inventory Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics-supply-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supply Chain</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/low-hanging-fruit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Low Hanging Fruit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/manufacturing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manufacturing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/meteorology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meteorology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nonprofits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonprofits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/politics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Politics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Product Development</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/product-development-general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/product-development-kpis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">KPIs</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/real-estate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Real Estate</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/retail.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Retail</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/saas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SaaS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/sports-betting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sports Betting</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-log-demfcast-misc" id="toc-sec-log-demfcast-misc" class="nav-link active" data-scroll-target="#sec-log-demfcast-misc">Misc</a></li>
  <li><a href="#sec-log-demfcast-artnot" id="toc-sec-log-demfcast-artnot" class="nav-link" data-scroll-target="#sec-log-demfcast-artnot">Article Notes</a>
  <ul>
  <li><a href="#sec-log-demfcast-artnot-apatdf" id="toc-sec-log-demfcast-artnot-apatdf" class="nav-link" data-scroll-target="#sec-log-demfcast-artnot-apatdf">Applying Prediction Adjustment to Demand Forecasts</a></li>
  <li><a href="#sec-log-demfcast-artnot-csasr" id="toc-sec-log-demfcast-artnot-csasr" class="nav-link" data-scroll-target="#sec-log-demfcast-artnot-csasr">Case Study: Automating Stock Replenishment</a></li>
  <li><a href="#sec-log-demfcast-artnot-dwshk" id="toc-sec-log-demfcast-artnot-dwshk" class="nav-link" data-scroll-target="#sec-log-demfcast-artnot-dwshk">Dealing with Shocks</a></li>
  </ul></li>
  <li><a href="#sec-log-demfcast-stakho" id="toc-sec-log-demfcast-stakho" class="nav-link" data-scroll-target="#sec-log-demfcast-stakho">Stakeholder Questions</a></li>
  <li><a href="#sec-log-demfcast-intdem" id="toc-sec-log-demfcast-intdem" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem">Intermittent Demand</a>
  <ul>
  <li><a href="#sec-log-demfcast-intdem-misc" id="toc-sec-log-demfcast-intdem-misc" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem-misc">Misc</a></li>
  <li><a href="#sec-log-demfcast-intdem-compdist" id="toc-sec-log-demfcast-intdem-compdist" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem-compdist">Compound Distributions</a></li>
  <li><a href="#sec-log-demfcast-intdem-fcastmn" id="toc-sec-log-demfcast-intdem-fcastmn" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem-fcastmn">Forecasting Mean Demand</a></li>
  <li><a href="#sec-log-demfcast-intdem-fcastvar" id="toc-sec-log-demfcast-intdem-fcastvar" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem-fcastvar">Forecasting Demand Variance</a></li>
  <li><a href="#sec-log-demfcast-intdem-diag" id="toc-sec-log-demfcast-intdem-diag" class="nav-link" data-scroll-target="#sec-log-demfcast-intdem-diag">Diagnostics</a></li>
  </ul></li>
  <li><a href="#sec-log-demfcast-metrics" id="toc-sec-log-demfcast-metrics" class="nav-link" data-scroll-target="#sec-log-demfcast-metrics">Metrics</a></li>
  <li><a href="#sec-log-demfcast-dim" id="toc-sec-log-demfcast-dim" class="nav-link" data-scroll-target="#sec-log-demfcast-dim">Decision Impact Metrics</a>
  <ul>
  <li><a href="#sec-log-demfcast-dim-misc" id="toc-sec-log-demfcast-dim-misc" class="nav-link" data-scroll-target="#sec-log-demfcast-dim-misc">Misc</a></li>
  <li><a href="#sec-log-demfcast-dim-famaf" id="toc-sec-log-demfcast-dim-famaf" class="nav-link" data-scroll-target="#sec-log-demfcast-dim-famaf">Forecast Accuracy Metrics Are Flawed</a></li>
  <li><a href="#sec-log-demfcast-dim-dicmp" id="toc-sec-log-demfcast-dim-dicmp" class="nav-link" data-scroll-target="#sec-log-demfcast-dim-dicmp">DI Components</a></li>
  <li><a href="#sec-log-demfcast-dim-steps" id="toc-sec-log-demfcast-dim-steps" class="nav-link" data-scroll-target="#sec-log-demfcast-dim-steps">Steps</a></li>
  </ul></li>
  <li><a href="#sec-log-demfcast-pffpp" id="toc-sec-log-demfcast-pffpp" class="nav-link" data-scroll-target="#sec-log-demfcast-pffpp">Profit Functions for Perishable Products</a></li>
  <li><a href="#sec-log-demfcast-drdsh" id="toc-sec-log-demfcast-drdsh" class="nav-link" data-scroll-target="#sec-log-demfcast-drdsh">Case Study: DoorDash</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/logistics-demand-planning.html">Logistics</a></li><li class="breadcrumb-item"><a href="../qmd/logistics-demand-planning.html">Demand Planning</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-log-demfcast" class="quarto-section-identifier">Demand Planning</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-log-demfcast-misc" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-misc">Misc</h2>
<ul>
<li>Also see
<ul>
<li><a href="https://ercbk.github.io/Data-Science-Notebook/qmd/forecasting-statistical.html#sec-fcast-stat-count" style="color: green">Forecasting, Statistical &gt;&gt; Count Forecasting</a></li>
</ul></li>
<li>Resources
<ul>
<li><a href="https://towardsdatascience.com/reinforcement-learning-for-inventory-optimization-series-iii-sim-to-real-transfer-for-the-rl-model-d260c3b8277d">Reinforcement Learning for Inventory Optimization Series III: Sim-to-Real Transfer for the RL Model | by Guangrui Xie | Jan, 2023 | Towards Data Science</a></li>
</ul></li>
<li>Used in Sales &amp; Operations Planning (S&amp;OP) process where the forecasts generated in this stage trickle down to other stages including supply planning, production scheduling, logistics planning, and inventory optimization.
<ul>
<li>Over-Forecasting can lead to excess working capital being tied up in inventory.</li>
<li>Under-Forecasting can stock out customers or lead to a scramble to make orders using more expensive raw materials and ship on short notice with more expensive transportation</li>
</ul></li>
<li>Challenges
<ul>
<li>Changes in the business environment — for instance, substitutes may replace a product, driving its demand down. Alternatively, new applications for a product may cause demand to go up compared to historical trends.</li>
<li>Shifts in business model — an organization may change its operating model and business strategy. For example, a chemical company may choose to shift their business from commodity chemicals to more specialty products, and so the historical demand patterns may not hold anymore.</li>
<li>Data availability — historical sales data, customer and product hierarchy data, and real-time orders data may be stored on disparate systems.</li>
<li>Data quality — this may include issues such as inaccurate data due to entry errors or data being captured at different and inconsistent granularity across data elements.</li>
</ul></li>
<li>Prepare forecasts for alternate scenarios
<ul>
<li>Talk with someone on the business side and ask about the potential scenarios within the forecast horizon that could affect the forecast.</li>
<li>Examples: a 10% inflation spike, supply disruption of a crucial raw material, a natural disaster, etc.</li>
<li>Rank these scenarios and factors in order of importance, so that you can prioritize.</li>
</ul></li>
<li>Horizons (Typical)
<ul>
<li>Short-Term: 1 - 3 months</li>
<li>Mid-Term: 6 - 18 months</li>
<li>Long-Term: 3 - 5 years</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-artnot" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-artnot">Article Notes</h2>
<section id="sec-log-demfcast-artnot-apatdf" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-artnot-apatdf">Applying Prediction Adjustment to Demand Forecasts</h3>
<ul>
<li><u>Misc</u>
<ul>
<li>Notes from <a href="https://towardsdatascience.com/are-your-demand-forecasts-hurting-profits-and-service-levels-f61af7c5ff">Are Your Demand Forecasts Hurting Profits and Service Levels</a></li>
<li>Blue Dot Thinking’s <a href="http://www.bluedotthinking.com/">WasteNot API service</a> ($) WasteNot (logistics analytics firm) uses prophet for demand forecasting which consistently under-predicts, so they use an adjustment for better forecasts</li>
</ul></li>
<li><u>Prediction Adjustment</u> - (e.g.&nbsp;for perishables) Calculate an optimal “Buffer Multiplier” value — each predicted value from the statistical forecast is multiplied by the multiplier, resulting in a higher number of units replenished each day
<ul>
<li>Variables used:
<ul>
<li>Unit Sale Price/Unit Cost</li>
<li>Historical Variability</li>
<li>Shelf-Life (seconds)</li>
<li>Stock Levels
<ul>
<li>They didn’t show the formula, but I’m guessing their modeling residuals with these variables.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-artnot-csasr" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-artnot-csasr">Case Study: Automating Stock Replenishment</h3>
<ul>
<li><u>Misc</u>
<ul>
<li>Notes from <a href="https://towardsdatascience.com/case-study-applying-a-data-science-process-model-to-a-real-world-scenario-93ae57b682bf">Case Study: Applying a Data Science Process Model to a Real-World Scenario</a></li>
<li>A VERY detailed article that goes through a scenario of step-by-step planning and execution of changing a manual stock replenishment process to an automated one</li>
<li>As a guide, they use <a href="https://medium.com/towards-data-science/dasc-pm-a-novel-process-model-for-data-science-projects-9f872f2534b1">DASC-PM</a> (DAta SCience - Process Model) - a structured and scientific process for project management</li>
</ul></li>
<li><u>Determine Feasibility</u>
<ul>
<li>Project manager tries to examine whether the project can fundamentally be classified as feasible and whether the requirements can be carried out with the available resources.</li>
<li>Expert Interviews: Is the problem in general is very well suited for the deployment of data science and are there corresponding projects that have already been undertaken externally and also published?</li>
<li>Data science team: Are there a sufficient number of potentially suitable methods for this project and are the required data sources are available?</li>
<li>IT department: check the available infrastructure and the expertise of the involved employees.</li>
</ul></li>
<li><u>Demand Forecasting Model</u>
<ul>
<li>Requirements:
<ul>
<li>Accuracy of 75%. This means that the forecasts for quantities of each product should deviate from actual requirements by no more than 25%.</li>
<li>Produce monthly planning cycles and quantify the need for short-term and long-term materials</li>
</ul></li>
<li>Data sources: order histories, inventory and sales figures for customers, and internal advertising plans</li>
<li>Features: seasonality, trends, and market developments</li>
<li>Forecasts regenerated every month</li>
</ul></li>
<li><u>Load Forecasts into Internal Planning Software</u>
<ul>
<li>Projections will be analyzed and, if need be, supplemented or corrected.
<ul>
<li>Planners can make their corrections during the first four working days of the month.</li>
<li>The final planning quantity will ultimately be used by the factories for production planning.</li>
</ul></li>
<li><span class="ribbon-highlight">Example</span>: IBM Planning Analytics
<ul>
<li>Allows for the creation of flexible views where the users can personally choose their context (time reference, product groups, etc.)and adjust calculations in real-time.</li>
<li>Sounds like expensive optimization software with a snazzy UI</li>
</ul></li>
<li>Final plans are loaded into the Data Lake after processing by the planning teams so they can be referenced in the future.</li>
</ul></li>
<li><u>User Integration</u>
<ul>
<li>Users are included in the development from the beginning to ensure technical correctness and relevance and to ensure familiarity with the solution before the end of the development phase.</li>
<li>Simple line and bar charts for processes and benchmarks are used, along with tables reduced to what is most important.</li>
<li>Planners get training sessions to help them interpret the forecasts and classify their quality.</li>
<li>Complete documentation is drafted
<ul>
<li>Technical part: data structures and connections</li>
<li>Content part: jointly prepared with the users to describe the usage of the data product</li>
</ul></li>
</ul></li>
<li><u>Post-Development Phase</u>
<ul>
<li>i.e.&nbsp;Maintenance of the project</li>
<li>Constant automated adjustment of the prediction model to new data</li>
<li>Various parameters such as the forecast horizon or threshold values for the accuracy of the prediction can be made by the planners</li>
<li>Problems occurring after the release of the first version are entered via the IT ticket system and assigned to the data science area</li>
<li>At regular intervals, it is also checked whether the model still satisfies the expectations of the company or whether changes are necessary.</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-artnot-dwshk" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-artnot-dwshk">Dealing with Shocks</h3>
<ul>
<li><u>Misc</u>
<ul>
<li>Forecasting shocks is difficult for an algorithm</li>
<li>Also see <a href="forecasting-dl.qmd#sec-fcast-dl-misc" style="color: green">Forecasting, Deep Learning &gt;&gt; Misc</a> &gt;&gt; Predictive Adjustment</li>
<li>Notes from <a href="https://doordash.engineering/2021/02/24/why-good-forecasts-treat-human-input-as-part-of-the-model/">Why Good Forecasts Treat Human Input as Part of the Model</a></li>
</ul></li>
<li><u>Preprocessing</u>
<ul>
<li>It can be better to smooth out (expected) shocks in the training data and then add an adjustment to the predictions during the dates of the shocks.</li>
<li>The smoothed out data will help the algorithm produce more accurate predictions for days when there isn’t an expected shock.
<ul>
<li>e.g.&nbsp;Kalman filter with parameters for seasonality, trends from <span style="color: goldenrod">{{tsmoothie}}</span>
<ul>
<li>Nothing special about this smoother. Probably just the method in tsmoothie that performed best for them (which is a good reason to use it).</li>
</ul></li>
</ul></li>
<li>Approaches for manually replacing oulier values
<ul>
<li>Replace the outlier week with the most recent week prior to the dip as a proxy for what should have happened.</li>
<li>Use domain knowledge
<ul>
<li>e.g.&nbsp;Marketing departiment is expecting 10% growth the week after it’s new promotion</li>
</ul></li>
<li>Replace with one of the previous methods, then apply a smoothing algorithm<br>
<a href="./_resources/Logistics.resources/image4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="./_resources/Logistics.resources/image4-1.png" class="img-fluid" width="432"></a>
<ul>
<li>Shows the Kalman filter by itself fails to replace the outlier dip with the normal, expected peak, but the manual adjustment + Kalman gives us what we want</li>
</ul></li>
</ul></li>
<li>Examples of shocks that may need training data to have manual adjustments and not be smoothed by an algorithm
<ul>
<li>One-time spikes due to abnormal weather conditions</li>
<li>One-off promotions
<ul>
<li>Replace the outlier week with the most recent week prior to the dip as a proxy for what should have happened.</li>
</ul></li>
<li>A sustained marketing campaign that is indistinguishable from organic growth.</li>
</ul></li>
</ul></li>
<li><u>Prediction Adjustment</u>
<ul>
<li>Extreme events (i.e.&nbsp;unprecedented promotions or weather), where the expected impact is well outside of any historical data, may prove impossible for forecasting methods to produce an adequate forecast
<ul>
<li>Since it’s outside the range of historical data, building a more complex model or just including weather or promotional features won’t help.</li>
</ul></li>
<li>Requires using domain expertise of the event to use to adjust the predictions</li>
<li>Make sure to build-out the code infrastructure so that each manual adjustment should just feel like adding another input to the model.</li>
</ul></li>
</ul>
</section>
</section>
<section id="sec-log-demfcast-stakho" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-stakho">Stakeholder Questions</h2>
<ul>
<li><u>Misc</u>
<ul>
<li>Questions for the stakeholder before starting a forecasting project.
<ul>
<li>For the most part, the questions with bold terms are ones that I consider essential for producing a valuable forecasting model.</li>
<li>The other questions might be optional depending on your role.
<ul>
<li>i.e.&nbsp;Unless you’re asked to review the overall decision making process and offer recommendations, the questions surrounding the decision-making process are not strictly necessary for producing a forecasting model.</li>
</ul></li>
</ul></li>
<li>Notes from: <a href="https://medium.com/@lingyi_99090/an-inquisitive-journey-into-forecasting-2f5289414ac2">An Inquisitive Journey into Forecasting</a></li>
</ul></li>
<li><u>Decisions and Actions</u>
<ul>
<li>What decisions is the forecast going to support? (e.g.&nbsp;plan for manufacturing, set inventory target, allocate marketing budget?) How are they made currently? Is there a clear and stable decision process?
<ul>
<li>A “clear and stable decision process” would mean that the decision-making process ,for which the forecast is an input, is the same each and every time a decision is made.</li>
<li>e.g.&nbsp;Adjusting a forecast based on vibes or politics or casually adding or removing other inputs to the decision-making process would <em>n</em>o<em>t</em> be stable</li>
</ul></li>
<li>Who are the key <strong>decision-makers</strong>? What does the <strong>decision process</strong> look like? Are there stakeholders who should have been involved but were left out?</li>
<li>What are the subsequent actions related to the decision? Who carries them out? How do people manage and carry out these actions in their day-to-day business? How well do actions adhere to decisions?</li>
<li>How often is the decision made? Is it the right <strong>frequency</strong> for the actions? (too frequent then it disrupts day-to-day business; too infrequent then we are slow to react to crucial trends and events)
<ul>
<li>e.g.&nbsp;Should the predicted values be weekly, monthly, quarterly, etc.?</li>
</ul></li>
<li>How much further into the future do people anticipate when making decisions? (i.e.&nbsp;the forecast <strong>horizon</strong>) Is it the right horizon for the actions? (too short then business will be forever in reactive mode, too long then forecasting team will just waste their energy on useless reports)</li>
<li>At which granularity do people make decisions? At which granularity do people take actions? Are they the same? If not, how do people bridge the gap to carry out their day-to-day business?
<ul>
<li>i.e.&nbsp;Is there <strong>hierarchical</strong> or <strong>group</strong> aspect to the forecast?</li>
</ul></li>
<li>What are the decisions and actions closely related to this one? Are those decisions providing input, constraints to the current one, or does the forecast enable them?</li>
<li>From a process perspective, how do they ensure that targets and forecasts are not interfering with each other? Is there a clear distinction between targets and forecasts in the company?
<ul>
<li>I think this one is asking if the forecasts get fudged to get inline with sales targets (?) which goes back to first question about a stable decision-making process.</li>
</ul></li>
</ul></li>
<li><u>Value</u>
<ul>
<li>Also see <a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-metrics" style="color: green">Metrics</a> for details on drilling down into this subject</li>
<li>How is the variable being forecasted related to the company’s OKRs/KPIs?</li>
<li>What value can a good decision bring about and what’s the cost of a bad decision? Can I make a <strong>dollar estimation of the impact</strong>? What would be a reasonable way to make this estimation, and what are the assumptions behind it?</li>
<li>Using the framework of value estimation established in the previous question, can I connect the metrics of forecast quality (e.g.&nbsp;accuracy, bias) to a dollar impact? What would be a reasonable level of impact to sponsor the upgrade / rebuild of the forecast model? How much model improvement would that entail?</li>
<li>Can I improve / refine the decision-making process without improving the forecast model? If so, how big is the value impact?</li>
<li>Are there any non-financial benefits, e.g.&nbsp;<strong>time and efficiency</strong>? Better adoption of data-driven decision making and higher trust in data and forecast? Internal capability building which paves the way for future technologies?
<ul>
<li>The time and efficiency in generating forecasts for the old forecasting model/process can be used as inputs in determining the overall ROI of your model.</li>
</ul></li>
<li>Does the <strong>80/20 rule</strong> apply to the value impact somewhere? For example, the majority of the value can come from a rather restricted scope of products, business lines, distribution channels, geographies and decisions.
<ul>
<li>If you’re creating a model with hierarchical or group data and for example, some products are more important for generating profit for the company than others, then the models forecasting those products best take priority in any sort of model selection process.</li>
</ul></li>
</ul></li>
<li><u>Drivers and Proxies</u> - While causal variables are good predictors (assuming they’re leading indicators), using <em>only</em> causal variables as predictors isn’t necessarily important to produce accurate predictions, but they are important for determining which levers can be adjusted by stakeholders in order to increase or decrease the future values of the forecast variable (e.g.&nbsp;sales). Use the answers to these questions to create a DAG. Then, models can be fit to measure their effects.
<ul>
<li>What are the <strong>key factors</strong> which impact the forecast target? (e.g.&nbsp;for demand, it could be price, promotion, marketing, channel distribution, etc.)</li>
<li>What is the mechanism between those factors and the forecast target? Can we establish <strong>causal links</strong> either through common sense or industry expertise?</li>
<li>Among those factors, which are the causal drivers and which are barely correlated?</li>
<li>What are the factors that we, as an organization, can <strong>control</strong>? (e.g.&nbsp;price and promotion)</li>
<li>What are the factors that we cannot control but we can <strong>observe</strong>?</li>
<li>What are the factors that are <strong>neither controllable nor observable</strong>, but we know they have an important impact on demand?
<ul>
<li>These will require proxy variables. (Also see <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/causal-inference.html#sec-causinf-misc" style="color: green">Causal Inference &gt;&gt; Misc</a> &gt;&gt; Partial Identification)</li>
</ul></li>
<li>What are the factors that influence the forecast target with a delay (i.e.&nbsp;forward-looking indicators / signals), and how long is the <strong>lead</strong> time?</li>
<li>How do people make forecasts currently? Do they use any of those factors and their relations to help them make the forecast? Is there a <strong>data-driven model</strong> in place?</li>
</ul></li>
<li><u>Data</u>
<ul>
<li>Do we have <strong>historical data</strong> for all the above-mentioned factors? How much history do we have for each factor? If direct data is not available, is it possible to find good proxies from public data sources or through <strong>data acquisition</strong>?</li>
<li>Can we obtain forward-looking indicators for the forecast target from sources like research organizations, public data, or <strong>internal resources</strong> (such as pricing and promotions)? Additionally, how far into the future do these data provide insights?</li>
<li><strong>Where</strong> do these data (historical &amp; forward-looking) come from? Are they generated internally from an ERP system, inputted manually by staff, or obtained from external data providers?</li>
<li>Is there a data cleaning process (<strong>ETL</strong>) that is used to prepare the data we have? How does it work? What are the main functions that it performs? Would this process mask key information that we want to get from the data? If that’s the case, is it possible to obtain the <strong>raw data</strong>?</li>
<li>What’s the granularity of those data? Is it as granular as the decisions? How often do those data get updated? Is it updated frequently enough for the decision process?</li>
<li>Do we have <strong>multiple sources</strong> for the same factor? If so, what are the key differences? Do different business units and teams use different sources or versions? What’s the reason behind it?</li>
<li>Does the data cover all products / business units? If not, what’s the reason for the low coverage? Can we calculate the percentage of the value pool which have <strong>proper data coverage</strong>? Does that look big enough? If not, can we think of ways to improve it?
<ul>
<li>“Value pool” refers the profits of the company and if there is sufficient data collection on the products that create the most value for the company.</li>
</ul></li>
<li>What’s a normal <strong>range</strong> for key business data and KPIs (e.g.&nbsp;accuracy, bias)? How do business people generally account for the fluctuation of those metrics?</li>
</ul></li>
<li><u>Draw Conclusions from the Answers</u>
<ul>
<li>Do I know what this forecast is built for, what’s the value? Where and how do we generate value? How is it linked to the forecast quality?</li>
<li>How can the forecast be designed (frequency, horizon, granularity, scope) to assist and guide the process? How do decision-makers and operational staff interact with the forecast? Does that make sense?</li>
<li>Do I fully understand how my forecast target is generated? What do the list of drivers, causal graph, and influence lag imply about my modeling? Does that fit well with the process?</li>
<li>Do I have enough &amp; good-quality data to build the first model? What might go wrong with the data, how to fix it (if possible)? How can we improve data quality, availability over time (how long would that be)?</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-intdem" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem">Intermittent Demand</h2>
<section id="sec-log-demfcast-intdem-misc" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem-misc">Misc</h3>
<ul>
<li>Notes from
<ul>
<li>CMAF FFT: Intermittent Demand Forecasting (<a href="https://www.youtube.com/watch?v=PRidAjQRtCs&amp;list=WL&amp;index=1">Video</a>)
<ul>
<li>From authors of “Intermittent Demand Forecasting. Context, Methods and Applications” (see your book shelf)</li>
</ul></li>
</ul></li>
<li>Preferrable to avoid intermittence by aggregating data to a category that’s higher in the product hierarchy or lengthen the frequency.
<ul>
<li>Not always possible. For example, different SKUs have different lead times, so aggregating products into categories with the same protection intervals can be complicated.</li>
</ul></li>
<li>Protection Interval is your horizon, which equals the length of the review period + length of the lead time
<ul>
<li>See <a href="../qmd/logistics-inventory-management.html#sec-log-invman-outpol" style="color: green">Order-Up-To (OUT) Level Policy</a> for details</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-intdem-compdist" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem-compdist">Compound Distributions</h3>
<ul>
<li>Target
<ul>
<li>Incidence/occurrence (of Demand): Poisson and Bernoulli</li>
<li>Discrete positive Demand interspersed with zeros: Neg. Binomial
<ul>
<li>Sounds like zero-inflated, censored distribution</li>
</ul></li>
</ul></li>
<li>Options
<ul>
<li>Discrete Compound Poisson (aka Stuttering Poisson): Poisson + Geometric</li>
<li>Negative Binomial: Poisson + Logarithmic</li>
</ul></li>
<li>Lumpy data
<ul>
<li>Data that’s intermittent and has extreme variability in demand sizes</li>
<li>Negative Binomial built to handle this type of data</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-intdem-fcastmn" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem-fcastmn">Forecasting Mean Demand</h3>
<ul>
<li><u>Parametric</u>
<ul>
<li>Modeling
<ul>
<li>Exponential Smoothing
<ul>
<li>Popular method but bad for intermittent forecasting</li>
<li>Biased on “issue points” (see video for more details)</li>
</ul></li>
<li>iETS
<ul>
<li><p>Captures multiplicative seasonality in data that has zeroes (as long as seasonal indices can be estimated somehow)</p></li>
<li><p>ADAM ebook <a href="https://openforecast.org/adam/ADAMIntermittent.html">chapter</a>, <a href="https://forecasting.svetunkov.ru/en/2018/09/18/smooth-package-for-r-intermittent-state-space-model-part-i-introducing-the-model/">post</a>, real world <a href="https://www.r-bloggers.com/2023/05/story-of-probabilistic-forecasting-of-hourly-emergency-department-arrivals/">use case</a> on adding an occurrence variable to an ETS model to handle intermittent data</p>
<ul>
<li>The use case paper also includes a GAMLSS with truncated Normal distribution model with code that performed well
<ul>
<li>Uses {<a href="https://github.com/jbrowell/ProbCast">probcast</a>} which has functions around gams, gamlss, and boosted gamlss models from {mgcv}, {mboost}, {gamlss}, etc.</li>
</ul></li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span>: From <a href="https://forecasting.svetunkov.ru/en/2023/09/08/iets-state-space-model-for-intermittent-demand-forecasting/">iETS: State space model for intermittent demand forecasting</a></p>
<ul>
<li><p>Model</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rpois</span>(<span class="dv">10</span>,<span class="dv">3</span>),<span class="fu">rpois</span>(<span class="dv">10</span>,<span class="dv">2</span>),<span class="fu">rpois</span>(<span class="dv">10</span>,<span class="dv">1</span>),<span class="fu">rpois</span>(<span class="dv">10</span>,<span class="fl">0.5</span>),<span class="fu">rpois</span>(<span class="dv">10</span>,<span class="fl">0.1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ts</span>(<span class="at">frequency=</span><span class="dv">12</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smooth)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>iETSModel <span class="ot">&lt;-</span> <span class="fu">adam</span>(y, <span class="st">"YYN"</span>, <span class="at">occurrence=</span><span class="st">"direct"</span>, <span class="at">h=</span><span class="dv">5</span>, <span class="at">holdout=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="arg-text">model = “YYN”</span>: Tells function to select the best pure multiplicative ETS model based on the information criterion
<ul>
<li>AICc used by default, see discussion in <a href="https://openforecast.org/adam/ETSSelection.html">Section 15.1</a> of the ADAM book</li>
</ul></li>
<li><span class="arg-text">occurrence = “direct”</span>: Specifies which of the demand occurrence models to build.
<ul>
<li>“direct” by default, the function will use the same model for the demand probability as the selected for the demand sizes.
<ul>
<li>So, for example, if we end up with ETS(M,M,N) for demand sizes, the function will use ETS(M,M,N) for the probability of occurrence.</li>
</ul></li>
<li>To change this, you would need to use the <code>oes()</code> to specify the model to predict the probability of occurrence
<ul>
<li>See examples in <a href="https://openforecast.org/adam/IntermittentExample.html">Section 13.4</a> of the ADAM book.</li>
</ul></li>
</ul></li>
<li><span class="arg-text">h = 5</span>: Sets the forecast horizon to 5 steps ahead</li>
<li><span class="arg-text">holdout = TRUE</span>: Says to keep the last 5 observations in the holdout sample</li>
</ul></li>
<li><p>Results</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iETSModel)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Model estimated using adam() function: iETS(MMN)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Response variable: y</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Occurrence model type: Direct</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Distribution used in the estimation: </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Mixture of Bernoulli and Gamma</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Loss function type: likelihood; Loss function value: 71.0549</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Estimate Std. Error Lower 2.5% Upper 97.5%  </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; alpha   0.1049     0.0925     0.0000      0.2903  </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; beta    0.1049     0.0139     0.0767      0.1049 *</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; level   4.3722     1.1801     1.9789      6.7381 *</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; trend   0.9517     0.0582     0.8336      1.0685 *</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Error standard deviation: 1.0548</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Sample size: 45</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of estimated parameters: 9</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of degrees of freedom: 36</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Information criteria:</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      AIC     AICc      BIC     BICc </span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 202.6527 204.1911 218.9126 206.6142 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Selected the iETS(M,M,N) model</li>
<li>“Mixture of Bernoulli and Gamma” tells us that the Bernoulli distribution was used for the demand occurrence (this is the only option), while the Gamma distribution was used for the demand sizes (this is the default option, but you can change this via the <span class="arg-text">distribution</span> argument).</li>
</ul></li>
<li><p>Demand Forecast</p>
<p><a href="_resources/Logistics.resources/iets-forecast-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="_resources/Logistics.resources/iets-forecast-1.webp" class="img-fluid" width="532"></a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(iETSModel, <span class="at">h=</span><span class="dv">5</span>, <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">side=</span><span class="st">"upper"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><span class="arg-text">side = “upper”</span>: Says we only want the upper prediction interval
<ul>
<li>For pure multiplicative models, <a href="https://openforecast.org/adam/ADAMForecastingPI.html#ADAMForecastingPISimulations">simulations are used</a>.</li>
<li>Since the <em>lowest</em> bound is zero, the upper bound is what’s useful for stocking decisions</li>
</ul></li>
</ul></li>
<li><p>Occurence Forecast (i.e.&nbsp;Stock or Not)</p>
<p><a href="_resources/Logistics.resources/iets-forecast-occurence-1.webp" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="_resources/Logistics.resources/iets-forecast-occurence-1.webp" class="img-fluid" width="532"></a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(iETSModel<span class="sc">$</span>occurrence, <span class="at">h=</span><span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Probability reaches roughly 0.2 over the next 5 months (i.e.&nbsp;we might sale once every 5 months).</li>
<li>If we think that this is too low then we should discontinue the product. Otherwise, if we decide to continue selling the product, then it makes more sense to generate the desired quantile of the cumulative demand over the lead time.</li>
</ul></li>
<li><p>Cumulative Demand Forecast</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(iETSModel, <span class="at">h=</span><span class="dv">5</span>, <span class="at">interval=</span><span class="st">"prediction"</span>, <span class="at">side=</span><span class="st">"upper"</span>, <span class="at">cumulative=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       Point forecast Upper bound (95%)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Oct 4      0.3055742          1.208207</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Based on the estimated model, we need to have two items in stock to satisfy the demand over the next 5 months with the confidence level of 95%.</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>Methods
<ul>
<li>Since these are methods they can’t incorporate predictive variables or produce prediction intervals</li>
<li><a href="https://doi.org/10.2307/3007885">Croston Method</a>
<ul>
<li>Inversion Bias: we believe the mean demand is higher than predicted</li>
</ul></li>
<li>SBA (<a href="https://doi.org/10.1057/palgrave.jors.2601841">Syntetos-Boylan Approximation</a>)
<ul>
<li>Recommended method</li>
<li>Corrects Croston bias</li>
<li>Supported by empirical evidence</li>
</ul></li>
<li>Temporal Aggregation: Overlapping vs Non-Overlapping
<ul>
<li>self-improving mechanism</li>
<li>See video for details (although it wasn’t discussed in great detail)</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Non-Parametric (aka Empirical)</u>
<ul>
<li>Bootstrapping
<ul>
<li>Resample in blocks or resample independently
<ul>
<li>Independently is how you normally see bootstrapping</li>
<li>With blocks, bin your sequential data into non-overlapping partitions and resample independently within each partition.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-intdem-fcastvar" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem-fcastvar">Forecasting Demand Variance</h3>
<ul>
<li>Using the variance of the forecast error of the protection interval to estimate the variance of demand over the protection interval
<ul>
<li>Classical method is to calculate the variance of the errors over each review period and aggregate to the get the variance over the protection interval, but the above method is better empirically and theoretically</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-intdem-diag" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-intdem-diag">Diagnostics</h3>
<ul>
<li>Also see
<ul>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-metrics" style="color: green">Metrics</a></li>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-dim" style="color: green">Decision Impact Metrics</a></li>
</ul></li>
<li>Do NOT use metrics based on absolute errors (e.g MASE, MAPE) <em>by themselves</em>
<ul>
<li>Minimization of these metrics, by themselves, can result (i.e.&nbsp;over half of your values are zeros) in always recommending 0 value forecasts</li>
<li>Can be used in conjunction with bias correction measures</li>
</ul></li>
<li>Scaled Mean Squared Error</li>
<li>Relative Root Mean Squared Error</li>
<li>Look at the predictive distributions instead of just the point forecasts</li>
<li>Accuracy Implication Metrics - Measure the effect of the forecast on inventory<br>
<a href="./_resources/Logistics.resources/Screenshot-(1319).png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="./_resources/Logistics.resources/Screenshot-(1319).png" class="img-fluid" width="432"></a>
<ul>
<li>Y Axis: 1 - Fill_Rate; X Axis: Average on-hand inventory</li>
<li>Each method is a forecasting model</li>
<li>Think the Fill Rate is estimated from a simulation using the method’s forecast and a range of average SOH values as parameters</li>
</ul></li>
</ul>
</section>
</section>
<section id="sec-log-demfcast-metrics" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-metrics">Metrics</h2>
<ul>
<li>See
<ul>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-intdem-diag" style="color: green">Demand Forecasting &gt;&gt; Intermittent Demand &gt;&gt; Diagnostics</a> &gt;&gt; Accuracy Implication Metrics</li>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-dim" style="color: green">Decision Impact Metrics</a></li>
</ul></li>
<li>Process
<ul>
<li>Discuss with your manager and team the purpose of the demand forecast. Is its goal to set accurate sales targets? To lower inventory levels? What are the underlying concerns behind these forecast numbers?
<ul>
<li>If increasing sales is the top concern, then maybe adjusting the forcast towards the higher end of the prediction interval is better. Increased inventory leads to less stockouts which leads to more sales</li>
<li>If decreasing inventory is the top concern, then maybe adjusting the forcast towards the lower end of the prediction interval is better as this will lead to decreased inventory and decreased cost.</li>
</ul></li>
<li>Create a simple business case to translate forecast accuracy metrics.
<ul>
<li>This will allow you to present your benefits of your model in business terms to a non-technical decision maker</li>
<li><span class="ribbon-highlight">Example</span>: Decreasing MASE by 50%
<ul>
<li>Current situation:
<ul>
<li>Existing forecasting method produces an average MASE of 20%.</li>
<li>Excess inventory costs average $50,000 per month due to inaccurate forecasts.</li>
<li>Stockouts lead to an average of $20,000 in lost sales per month.</li>
</ul></li>
<li>After Improving Forecast:
<ul>
<li>By reducing MASE to 10% (decrease of 50%), the company can expect:
<ul>
<li>Reduced excess inventory costs: Inventory costs could be reduced by $25,000 per month (50% decrease).</li>
<li>Increased sales: More accurate forecasts allow for optimal stock levels, potentially leading to a $10,000 increase in monthly sales.</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>Diagram the decision making process
<ul>
<li>In many cases, the decision-maker or others will make subjective adjustments to forecasts</li>
<li>The diagram should include the decision being made, the inputs for the decision, who’s making the decision, and the outcomes that follow.</li>
<li>Each adjustment should be documented, so as to better assess how where improvement needs to made in the process.</li>
</ul></li>
</ul></li>
<li>WasteNot method for judging its adjusted forecast model vs prophet<br>
<a href="./_resources/Logistics.resources/1-ni6N2L4yp0ynlOzL01f8Fg.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="./_resources/Logistics.resources/1-ni6N2L4yp0ynlOzL01f8Fg.png" class="img-fluid" width="532"></a>
<ul>
<li>Change in the Number of Stock-Out Days (lower is better)</li>
<li>Percent Change in Service Level (higher is better)</li>
<li>Change in Profit (higher is better)</li>
<li>Change in Wastage (lower is better)</li>
<li>Change in Inventory Costs (lower is better)</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-dim" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-dim">Decision Impact Metrics</h2>
<section id="sec-log-demfcast-dim-misc" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-dim-misc">Misc</h3>
<ul>
<li>Also see
<ul>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-metrics" style="color: green">Metrics</a></li>
<li><a href="../qmd/logistics-demand-planning.html#sec-log-demfcast-intdem-diag" style="color: green">Demand Forecasting &gt;&gt; Intermittent Demand &gt;&gt; Diagnostics</a> &gt;&gt; Accuracy Implication Metrics</li>
</ul></li>
<li>DI metrics for all generated forecasts can be used to calculate a quarterly, semestrial, or annual ROI for the product planning department
<ul>
<li>ROI = sum(<span class="math inline">\(DI_{na}\)</span>)- (cost of people, tools, etc. used by department to generate forecasts)</li>
</ul></li>
<li>Probabilistic Forecasts + DI metrics
<ul>
<li>Identify parameters (i.e.&nbsp;whatever value you’re forecasting) with the highest economic risk
<ul>
<li>Economic risk is <em>related</em> to the size of the PI of the forecast</li>
</ul></li>
<li>Investigate potential causes for the risk and find solutions</li>
<li><span class="ribbon-highlight">Example</span>
<ul>
<li><p>Calculate</p>
<ul>
<li><span class="math inline">\(\min(DI_a)\)</span> - the costs associated with the forecast at the 5% percentile</li>
<li><span class="math inline">\(\max(DI_a)\)</span> - the costs associated with the forecast at 95% percentile.</li>
</ul></li>
<li><p>Calculate economic risk</p>
<p><span class="math display">\[
\text{risk}_{\text{econ}} = \left|\max(DI_a) - \min(DI_a)\right|
\]</span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-dim-famaf" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-dim-famaf">Forecast Accuracy Metrics Are Flawed</h3>
<ul>
<li>Industry benchmarks for these metrics aren’t useful. Each business regardless whether they’re in they’re in the same industry has diverse business strategies (e.g.&nbsp;size of portfolio, product &amp; brand positioning)</li>
<li>Constraints and business rules have to be considered and not just a forecast metric
<ul>
<li>e.g.&nbsp;Allowed pack sizes, the minimum order quantity, the storage finite capacity, holding/excess costs, shortage costs, fixed costs, etc.</li>
</ul></li>
<li>Forecast Accuracy (FA) metrics are difficult to understand for normals
<ul>
<li>Using Decision Impact (DI) metrics can help eliminate:
<ul>
<li><em>“The forecast is always wrong!”, “The forecast is too this”, “The forecast is not enough that”, “What does 70% FA mean?”, “Is this good or bad?”</em></li>
</ul></li>
</ul></li>
<li><a href="https://www.youtube.com/watch?v=o70E_qMnT5s">Forecast Value Added</a> (FVA)
<ul>
<li>FVA: The change in a forecasting accuracy metric that can be attributed to a particular process or participant in the forecasting process.
<ul>
<li><span class="ribbon-highlight">Example</span><br>
<a href="./_resources/Logistics.resources/Screenshot-(807).png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="./_resources/Logistics.resources/Screenshot-(807).png" class="img-fluid" width="282"></a>
<ul>
<li>Statistical model has 5% FVA vs Naive forecast</li>
<li>Adjusted Statistical Forecast has 2% FVA vs Naive Forecast
<ul>
<li>Forecast gets manually adjusted by management</li>
</ul></li>
</ul></li>
</ul></li>
<li>Reasons why FVA shouldn’t be used by itself
<ul>
<li>The difference in Forecast Accuracy (FA) metrics (e.g.&nbsp;MAPE) of the production forecasting algorithm and the naive forecasting algorithm is usually weighted by portfolio revenue, volume or number of items</li>
<li>A FA metric is not a key business performance indicator (KPI)
<ul>
<li>FA has little correlation with business performance.</li>
<li>Therefore, improving FA does not mean you are generating value.</li>
<li>Costs may increase, decrease or remain the same as accuracy changes.</li>
</ul></li>
<li>FA metrics can contradict each other
<ul>
<li>Switching from one FA metric to another could profoundly alter your FVA results.</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-dim-dicmp" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-dim-dicmp">DI Components</h3>
<ul>
<li><u>Decision-based Components</u> - components that take into account the decision being made using the forecast
<ul>
<li><span class="ribbon-highlight">Example</span>: One weather forecast predicts 4 inches of rain but another forecast predicts 0 inches of rain. The next day it rains 1 inch.
<ul>
<li>If the decision being made was whether to take an umbrella, the first forecast is the best forecast even though its error is worse than the second forecast.</li>
</ul></li>
<li>Components
<ul>
<li><strong>Decision Function</strong> - For any forecast input, simulate the decision process and evaluate the quality of the final decision</li>
<li><strong>Decision Impact (DI)</strong> - Metric that defines how decision quality is measured
<ul>
<li>Usually in terms of financial cost</li>
<li>A “North Star” type metric</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Decision Cost Function</u>: The cost function is used to score each stock replenishment decision based on its true business impact usually in terms of financial cost
<ul>
<li><span class="ribbon-highlight">Example</span>: Walmart Retail Data (M5)
<ul>
<li>The Decision Cost is the sum of following factors:
<ul>
<li>Ordering, shipping and handling cost (Fixed Costs)
<ul>
<li>Fulfilling an order generates costs for the ordering, preparation, expedition, transportation, etc.</li>
<li>Let’s assume these costs represent $40 per $1000 of purchase value.</li>
</ul></li>
<li>Holding cost (Excess Costs)
<ul>
<li>Holding costs are associated with the storage of unsold inventories.</li>
<li>Let’s assume the annual holding cost is 10% of the inventory value (valued at purchase price), e.g.&nbsp;0.19% per week.</li>
</ul></li>
<li>Shortage cost
<ul>
<li>When demand exceeds the available inventory, both the demand and customer goodwill may be lost.</li>
<li>As retailers propose a wide range of similar products, a part of the excess demand is carried on to other products.</li>
<li>Let’s assume that only half of the sales will effectively be lost. The shortage cost could then be measured as 50% of each lost sale gross margin.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Other Considerations
<ul>
<li>Replenishment Strategy
<ul>
<li>Leadtime</li>
<li>Order Cycle</li>
<li>Replenishment Policy</li>
<li>Safety Stock</li>
</ul></li>
<li>Additional Product Information
<ul>
<li>Gross Margin</li>
<li>Pack Sizes</li>
<li>Initial Inventory
<ul>
<li>Example: Using the safety stock value</li>
</ul></li>
</ul></li>
<li>Computational Costs
<ul>
<li>Algorithm training time</li>
<li>Compute size</li>
<li>Data pipeline</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Required Forecasts</u>
<ul>
<li>“Actual” Forecast: Forecast from a candidate model that will potentially go into production</li>
<li>“Naive” Forecast: Forecast from a simple method (e.g.&nbsp;seasonal-naive, simple moving average, etc.) or a previous used method</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-dim-steps" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-dim-steps">Steps</h3>
<ol type="1">
<li>Decide how best to measure the Decision Impact as related to the forecast
<ul>
<li>e.g.&nbsp;Financial Cost</li>
</ul></li>
<li>Formulate a decision cost function
<ul>
<li>e.g.&nbsp;Fixed Costs + Holding Costs + Shortage Costs (See Walmart example above)</li>
</ul></li>
<li>Generate forecasts on a test/assessment set.</li>
<li>Calculate Decision Impact Costs
<ul>
<li><strong>Actual Cost</strong> (<span class="math inline">\(DI_a\)</span>): Cost after applying the decision cost function to the “actual” forecast (See above)</li>
<li><strong>Naive Cost</strong> (<span class="math inline">\(DI_n\)</span>): Cost after applying the decision cost function to the “naive” forecast (see above)</li>
<li><strong>Oracle Cost</strong> (<span class="math inline">\(DI_o\)</span>): Cost after applying the decision cost function to the observed values
<ul>
<li>This would be the costs of a forecast in which we had perfect knowledge. (So probably just Fixed Costs)</li>
</ul></li>
</ul></li>
<li>Calculate Decision Impact metrics:
<ul>
<li><p><strong>Earned Value</strong> (aka <strong>Forecast Value Added</strong>) (<span class="math inline">\(DI_{na}\)</span>)</p>
<p><span class="math display">\[
DI_{na} = DI_n - DI_a
\]</span></p></li>
<li><p><strong>Unearned Value</strong> (aka <strong>Yet-To-Be-Earned Value</strong>)(<span class="math inline">\(DI_{ao}\)</span>)</p>
<p><span class="math display">\[
DI_{ao} = DI_a -DI_o
\]</span></p>
<ul>
<li>The value that could still be gained by improving forecasts</li>
</ul></li>
<li><p><strong>Total Earnable Value</strong> (<span class="math inline">\(DI_{no}\)</span>)</p>
<p><span class="math display">\[
DI_{no} = DI_n - DI_o
\]</span></p>
<ul>
<li>The range of earnable value</li>
</ul></li>
<li><p><strong>Proportion of the Earned Value</strong></p>
<p><span class="math display">\[
\frac{DI_{na}}{DI_{no}}
\]</span></p></li>
<li><p><strong>Proportion of Yet-To-Be-Earned value</strong></p>
<p><span class="math display">\[
\frac{DI_{ao}}{DI_{no}}
\]</span></p></li>
</ul></li>
</ol>
</section>
</section>
<section id="sec-log-demfcast-pffpp" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-pffpp">Profit Functions for Perishable Products</h2>
<ul>
<li><p>The newsvendor problem is a class of problems, where the product can only be sold one day, after which it goes to waste. So this is appropriate, for example, for perishable products in retail</p></li>
<li><p>Notes from An <a href="https://forecasting.svetunkov.ru/en/2021/09/03/an-integrated-method-for-estimation-and-optimisation/">Integrated Method for Estimation and Optimisation</a>; associated <a href="http://dx.doi.org/10.13140/RG.2.2.27057.81763">paper</a></p></li>
<li><p>If we order more than needed, we will have <strong>holding costs</strong>. In the opposite case, we will have <strong>shortage costs</strong>.</p>
<ul>
<li>Based on these costs and the price of product, we can find the optimal amount of product to order, that will give the maximum profit.</li>
</ul></li>
<li><p>Instead of a two-stage problem (see DoorDash section): Optimising the forecast model via MSE or any other conventional loss and then solving the optimisation problem, we could estimate the model via maximization of the specific <strong>profit function</strong>, thus obtaining the required number of product orders directly.</p></li>
<li><p>Calculate profit as a linear function</p>
<p><span class="math display">\[
\pi(q_t,y_t) =
\left\{ \begin{array}{lcl}
py_t - vq_t - c_h(q_t - y_t) &amp; \text{for}\;\; q_t \geq y_t \\
pq_t - vq_t - c_s(y_t-q_t) &amp; \text{for}\;\; q_t &lt; y_t
\end{array}\right.
\]</span></p>
<ul>
<li><span class="math inline">\(y_t\)</span>: Actual Sales</li>
<li><span class="math inline">\(p\)</span>: Price of the Product</li>
<li><span class="math inline">\(q_t\)</span>: Order Quantity</li>
<li><span class="math inline">\(v\)</span>: Cost of Production</li>
<li><span class="math inline">\(c_h\)</span>: Holding Cost</li>
<li><span class="math inline">\(c_s\)</span>: Shortage Cost</li>
</ul></li>
<li><p><span class="ribbon-highlight">Example</span></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(greybox)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate artificial data</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">100</span>,<span class="dv">10</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">100</span>,<span class="dv">2</span>,<span class="fl">0.05</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>x1 <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>x2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ourData <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">y=</span>y,<span class="at">x1=</span>x1,<span class="at">x2=</span>x2)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define price and costs</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>costBasic <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>costShort <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>costHold <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Define profit function for the linear case</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>lossProfit <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, fitted, B, xreg){</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="co"># Minus sign is needed here, because we need to minimise the loss</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; profit <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">ifelse</span>(actual <span class="sc">&gt;=</span> fitted,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (price <span class="sc">-</span> costBasic) <span class="sc">*</span> fitted <span class="sc">-</span> costShort <span class="sc">*</span> (actual <span class="sc">-</span> fitted),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; price <span class="sc">*</span> actual <span class="sc">-</span> costBasic <span class="sc">*</span> fitted <span class="sc">-</span> costHold <span class="sc">*</span> (fitted <span class="sc">-</span> actual));</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; <span class="fu">return</span>(<span class="fu">sum</span>(profit));</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the model</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">alm</span>(y<span class="sc">~</span>x1<span class="sc">+</span>x2, ourData, <span class="at">loss=</span>lossProfit)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of the model</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1, <span class="at">bootstrap=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Estimate Std. Error Lower <span class="fl">2.5</span><span class="sc">% Upper 97.5%</span>&nbsp;</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>(Intercept)&nbsp; <span class="fl">36.5177</span>&nbsp; &nbsp; <span class="fl">14.2840</span>&nbsp; &nbsp; <span class="fl">2.7783</span>&nbsp; &nbsp; <span class="fl">51.4844</span> <span class="sc">*</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="fl">1.3622</span>&nbsp; &nbsp; <span class="fl">0.1622</span>&nbsp; &nbsp; <span class="fl">1.1909</span>&nbsp; &nbsp; &nbsp; <span class="fl">1.7528</span> <span class="sc">*</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>x2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="fl">3.3423</span>&nbsp; &nbsp; <span class="fl">2.7810</span>&nbsp; &nbsp; <span class="sc">-</span><span class="fl">6.5997</span>&nbsp; &nbsp; &nbsp; <span class="fl">5.9101</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Interpretation: With the increase of the variable x1, the orders should change on average by 1.36</p></li>
<li><p>Plot<br>
<a href="./_resources/Logistics.resources/ordersDynamics.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="./_resources/Logistics.resources/ordersDynamics.png" class="img-fluid" width="632"></a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model1, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Figure above corresponds to the orders (purple) and would cover roughly 90.91% of cases (black), so that we would run out of product in approximately 10% of cases, which would still be more profitable than any other option.</li>
</ul></li>
</ul></li>
<li><p>Nonlinear case</p>
<ul>
<li>See link to associated paper above</li>
<li>The only thing that would change is the loss function, where the prices and costs would depend non-linearly on the order quantity and sales.</li>
</ul></li>
</ul>
</section>
<section id="sec-log-demfcast-drdsh" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-log-demfcast-drdsh">Case Study: DoorDash</h2>
<ul>
<li>Notes from <a href="https://towardsdatascience.com/managing-supply-and-demand-balance-through-machine-learning-70d4f0808617" class="uri">https://towardsdatascience.com/managing-supply-and-demand-balance-through-machine-learning-70d4f0808617</a></li>
<li><u>Problem Definition</u>
<ul>
<li>Supply and demand imbalance&nbsp; (i.e.&nbsp;drivers and food orders)</li>
<li>Effects
<ul>
<li>For consumers, a lack of driver availability during peak demand is more likely to lead to order lateness, longer delivery times, or inability to request a delivery and having to opt for pick up.</li>
<li>For Dashers, a lack of orders leads to lower earnings and longer and more frequent shifts in order to hit personal goals.</li>
<li>For merchants, undersupply leads to delayed deliveries, which typically results in cold food and a decreased reorder rate.</li>
</ul></li>
</ul></li>
<li><u>2-Stage Solution</u>
<ul>
<li>Forecast supply and demand</li>
<li>Optimize supply of workers with demand of food orders
<ul>
<li>Optimization Strategies
<ul>
<li>Balancing at the delivery level means every order has a Dasher available at the most optimal time
<ul>
<li>Consumer preferences and other changing conditions in the environment, such as traffic and weather, make it difficult to balance supply and demand at the delivery level</li>
</ul></li>
<li>Balancing at the market level means there are relatively equal numbers of Dashers and orders in a market but there are not necessarily optimal conditions for each of these groups at the delivery level.</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Metrics</u>
<ul>
<li>Number of hours required to make deliveries during a time period
<ul>
<li>Optimize keeping delivery durations low and Dasher (drivers) busy-ness high</li>
<li>Able to account for regional variation driven by traffic conditions, batching rates, and food preparation times.</li>
</ul></li>
<li>Units: hourly or parts-of-day (e.g.&nbsp;breakfast, lunch, dinner)
<ul>
<li>There’s too much variation during a day in order to aggregate to a higher level metric. Demand and supply would be artifically smoothed.</li>
</ul></li>
<li><span class="ribbon-highlight">Example</span>:
<ul>
<li>Sunday at dinner time in New York City, and we estimate that 1,000 driver hours are needed to fulfill the expected demand. We might also estimate that unless we provide extra incentives, only 800 hours will likely be provided organically. Without mobilization actions we would be undersupplied by about 200 hours.</li>
</ul></li>
<li>Optimization
<ul>
<li>Adjust supply of drivers by incentivizing with pay bonues during high demand hours</li>
</ul></li>
</ul></li>
<li><u>Forecast Supply and Demand</u>
<ul>
<li>Demand
<ul>
<li>LightGBM</li>
<li>Predictors
<ul>
<li>Information about population size, general traffic conditions, number of available merchants, climate, and geography</li>
<li>Character variables were replaced with embedding vectors</li>
</ul></li>
</ul></li>
<li>Supply
<ul>
<li>Counterfactual to understand how to make tradeoffs between supply and costs
<ul>
<li>How will supply levels change if we changed incentive levels so that we can ?</li>
<li>I assume “incentive_level” is a variable in the supply forecast model, so this could just be adjusted in “newdata” and a&nbsp; prediction (or maybe during a training session?) made to see the effects on supply.</li>
</ul></li>
</ul></li>
</ul></li>
<li><u>Optimization</u>
<ul>
<li>Input supply and demand predictions and generate a set of optimal actions</li>
<li>Mixed-Integer Programming (MIP)
<ul>
<li>Also see <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/optimization-equation-systems.html" style="color: green">Optimization, Equation Systems</a></li>
<li>Linear Optimization (<span style="color: #990000">{ompr}</span>)</li>
<li>Easy to formalize, implement, and explain to stakeholders</li>
<li>Custom objective function for minimizing undersupply with several constraints.
<ul>
<li>Can be configured to favor either profitability (profit per customer?) or growth (increase in orders per customer?)
<ul>
<li>Or maybe its about drivers — profitability (just enough incentive to get just enough drivers?) or growth (not sure what the “driver” angle is here)</li>
</ul></li>
<li>Constraints
<ul>
<li>Never allocate more than one incentive in a particular region-time unit.</li>
<li>Never exceed the maximum allowable budget set by our finance and operations partners.</li>
<li>Regional
<ul>
<li>Different budgets, custom penalties, exclusion criteria for which units should not be included in the optimization, or incentive constraints that are guided by variability of the inputs.</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>Optimizer must account for uncertainty<a href="./_resources/Logistics.resources/Screenshot-(363).png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="./_resources/Logistics.resources/Screenshot-(363).png" class="img-fluid" width="432"></a>
<ul>
<li>City B’s forecast distribution has substantial uncertainty, and it’s mean says it will have enough drivers (i.e.&nbsp;oversupply)</li>
<li>City A’s forecast distribution is more certain, and it’s more likely to be undersupplied.</li>
<li>W/o taking uncertainty into account, the optimizer will not take into account that there’s a sizeable chance B will be undersupplied</li>
<li>Taking uncertainty into account sometimes causes an over-allocation of resources to these uncertain regions (small areas, fewer orders, fewer drivers, larger variance)</li>
<li>They do something with resampling to solve this but I didn’t quite understand it.</li>
</ul></li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/location-selection.html" class="pagination-link" aria-label="Location Selection">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Location Selection</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/logistics-inventory-management.html" class="pagination-link" aria-label="Inventory Management">
        <span class="nav-page-text">Inventory Management</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">
<p>Creative Commons Attribution-NonCommercial 4.0 International Public License</p>
</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"loop":false,"selector":".lightbox","descPosition":"bottom","openEffect":"zoom","closeEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>