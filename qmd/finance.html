<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Domain Knowledge - Finance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../qmd/healthcare.html" rel="next">
<link href="../qmd/epidemiology.html" rel="prev">
<link href="../images/dk-favicon-32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../qmd/finance.html">Finance</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Domain Knowledge</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://ericbook.netlify.app/" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="https://github.com/ercbk/Domain-Knowledge-Notebook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/agriculture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agriculture</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/banking-credit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Banking/Credit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/budget-allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Budget Allocation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/economics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Economics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/environment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Environment</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/epidemiology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/finance.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Finance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/healthcare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Healthcare</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/insurance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Insurance</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/kpis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">KPIs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/location-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Location Selection</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Logistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/low-hanging-fruit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Low Hanging Fruit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/manufacturing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manufacturing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/marketing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Marketing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/meteorology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meteorology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/nonprofits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nonprofits</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/politics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Politics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/product-development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Product Development</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/real-estate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Real Estate</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/retail.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Retail</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/saas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SaaS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../qmd/sports-betting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sports Betting</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-finance-misc" id="toc-sec-finance-misc" class="nav-link active" data-scroll-target="#sec-finance-misc">Misc</a></li>
  <li><a href="#sec-finance-terms" id="toc-sec-finance-terms" class="nav-link" data-scroll-target="#sec-finance-terms">Terms</a></li>
  <li><a href="#considerations" id="toc-considerations" class="nav-link" data-scroll-target="#considerations">Considerations</a></li>
  <li><a href="#sec-finance-6040" id="toc-sec-finance-6040" class="nav-link" data-scroll-target="#sec-finance-6040">60/40 Portfolio Strategy</a></li>
  <li><a href="#sec-finance--momassallo" id="toc-sec-finance--momassallo" class="nav-link" data-scroll-target="#sec-finance--momassallo">Momentum Tactical Asset Allocation Strategy</a></li>
  <li><a href="#sec-finance-vtp" id="toc-sec-finance-vtp" class="nav-link" data-scroll-target="#sec-finance-vtp">Volatility Targeting Portfolio</a></li>
  <li><a href="#sec-finance-meanrev" id="toc-sec-finance-meanrev" class="nav-link" data-scroll-target="#sec-finance-meanrev">Mean Reversion Strategy or Pairs Trading</a></li>
  <li><a href="#bonds" id="toc-bonds" class="nav-link" data-scroll-target="#bonds">Bonds</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-finance" class="quarto-section-identifier">Finance</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="sec-finance-misc" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-misc">Misc</h2>
<ul>
<li><p>Resources</p>
<ul>
<li>Advances in Financial Machine Learning - de Prado (R &gt;&gt; Documents &gt;&gt; Financial)</li>
<li><a href="https://ml4trading.io/">Machine Learning for Algorithmic Trading</a>
<ul>
<li>Github <a href="https://github.com/stefan-jansen/machine-learning-for-trading">repo</a> with the code that’s referred to in the book</li>
</ul></li>
</ul></li>
<li><p>Packages</p>
<ul>
<li><a href="https://cran.r-project.org/web/views/Finance.html">CRAN Task View</a></li>
<li><span style="color: goldenrod">{{</span><a href="https://pypi.org/project/zipline-reloaded/" style="color: goldenrod">zipline-reloaded</a><span style="color: goldenrod">}}</span> - Backtesting and live-trading engine by crowd-sourced investment fund Quantopian</li>
<li><span style="color: goldenrod">{{</span><a href="https://pyfolio.ml4trading.io/" style="color: goldenrod">pyfolio</a><span style="color: goldenrod">}}</span> - Performance and risk analysis for financial portfolios</li>
<li><span style="color: goldenrod">{{</span><a href="https://alphalens.ml4trading.io/" style="color: goldenrod">alphalens</a><span style="color: goldenrod">}}</span> - Performance analysis of predictive stock factors</li>
</ul></li>
<li><p><a href="https://my.openbb.co/login">OpenBB</a> - Open source bloomberg terminal (overview <a href="https://www.quantscience.io/newsletter/b/how-to-get-free-financial-data">article</a>)</p>
<ul>
<li>Free data and seemingly hundreds of different tools including some decent forecast methods.</li>
</ul></li>
<li><p>Technical vs Fundamental Analysis</p>
<ul>
<li><em>Technical analysis</em> in many cases tends to amplify stock price trends because many technical traders buy when stocks are rising and sell when they fall.</li>
<li><em>Fundamental analysis</em> on the contrary often shows mean-reverting behaviour because its adherents try to buy undervalued stocks and sell overvalued ones</li>
</ul></li>
<li><p>Smoothers</p>
<ul>
<li>Simple Moving Average (SMA) is simple, easy to implement but reacts slowly to recent price changes due to equal weighting of all prices in the window.</li>
<li>Exponential Moving Average (EMA) reacts faster to recent price changes due to more weight to the latest prices.</li>
<li>Kalman Filter is more sophisticated and can adaptively weigh incoming measurements based on their estimated noise level, potentially providing superior results in many applications. However, it has key parameters that must be tuned to get good results.</li>
</ul></li>
<li><p>Strategies</p>
<ul>
<li>Hedgefund - factor rotations (longer term)</li>
<li>Something about futures - factor tilts (shorter term)</li>
</ul></li>
<li><p>Misleading chart (<a href="https://twitter.com/choffstein/status/1640034865817985024">Thread</a>)<br>
<img src="./_resources/Finance.resources/image.png" class="img-fluid" width="448"><br>
</p>
<ul>
<li>No transaction costs</li>
<li>No fees</li>
<li>No taxes</li>
<li>US “exceptionalism”</li>
<li>Overlapping time period analysis
<ul>
<li>Example: if I look at 1920-1950 and then 1921-1951, twenty eight of the thirty data points are overlapping. So there’s not a lot of “unique” data in this set.</li>
</ul></li>
<li>Nominal vs real returns - Time weighted vs dollar weighted returns</li>
</ul></li>
<li><p>Workflow</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="_resources/Finance.resources/ml4t_workflow-1.png" class="img-fluid figure-img" width="532"></p>
<figcaption class="figure-caption">From Machine Learning for Algorithmic Trading</figcaption>
</figure>
</div></li>
</ul>
</section>
<section id="sec-finance-terms" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-terms">Terms</h2>
<ul>
<li><span style="color: #009499"><strong>Basis Point</strong></span> - 1/100th of a percentage point</li>
<li><span style="color: #009499"><strong>Basis Risk</strong></span> - the risk that an asset and a hedge will not move in opposite directions as expected; “basis” refers to the discrepancy.</li>
<li><span style="color: #009499"><strong>Beta</strong></span> - A measure of a stock’s or a portfolio’s sensitivity to market movements. It quantifies the relationship between the price movements of a security and the overall market. A beta of 1 indicates that the security tends to move in line with the market, while a beta greater than 1 implies that the security is more volatile than the market. A beta less than 1 suggests that the security is less volatile than the market. Often used as a tool to assess the risk or volatility of a particular stock or portfolio in comparison to the overall market</li>
<li><span style="color: #009499"><strong>Capital expenditure (CapEx)</strong></span> - money that is spent to acquire, repair, update, or improve a fixed company asset, such as a building, business, or equipment. For assets to fall under the CapEx destination, the investments must have a useful life of one year or more. A CapEx is amortized, or its value is deducted a little each year based on the total cost and its expected useful life.
<ul>
<li>Useful life refers to the estimated and generally agreed upon shelf life of a specific business asset.
<ul>
<li>According the IRS, Car’s useful life is 5yrs and new building’s is 39yrs</li>
</ul></li>
<li>Also see <a href="https://www.shopify.com/blog/what-is-capex#:~:text=A%20CapEx%20is%20amortized%2C%20or,a%20new%20building's%20is%2039.">What Is a Capital Expenditure (CapEx)? Definition and Guide</a> (example, calculations, relation to operating expenditure (OpEx)</li>
</ul></li>
<li><span style="color: #009499"><strong>Cost of Carry</strong></span> or <span style="color: #009499"><strong>Carrying Charge</strong></span> - the cost of holding a security or a physical commodity over a period of time. The carrying charge includes insurance, storage and interest on the invested funds as well as other incidental costs
<ul>
<li>For a stock, it’s is the opportunity cost of the capital that goes into it plus the risk you take on for holding it (this is what the idea of risk neutral valuation is based on).</li>
</ul></li>
<li><span style="color: #009499"><strong>Coupon</strong></span> - Bonds pay a set return each year, called a coupon, over a set period ending on a maturity date. The amound of the coupon depends on the interest rate that was determined when the bond was issued.</li>
<li><span style="color: #009499"><strong>Derivatives</strong></span> are securities that move in correspondence to one or more underlying assets. They include options, swaps, futures and forward contracts. The underlying assets can be stocks, bonds, commodities, currencies, indices or interest rates. Derivatives can be effective hedges against their underlying assets, since the relationship between the two is more or less clearly defined (if they’re negatively correlated? Or maybe if the underlying asset goes down, there’s a lag between the asset going down and the derivative going down. Therefore, you can sell the derivative before it goes down. Thus, hedging your risk). Knowing the value of an underlying asset helps traders determine the appropriate action (buy, sell, or hold) with their derivative.</li>
<li><span style="color: #009499"><strong>Exchange Traded Fund (ETF)</strong></span> - A mutual fund that may be traded daily like a stock or bond.</li>
<li><span style="color: #009499"><strong>False Strategy Theorem</strong></span> - Gives the threshold for which a Sharpe Ratio would be significant.
<ul>
<li>Given a sample of estimated performance statistics (e.g.&nbsp;sharpe ratios), {Sk} for k = 1, …, K, where each S ∈ N(0, 1) <span class="math display">\[
        \mathbb{E}[\max_{k} {S_k}] \approx (1-\gamma) Z^{-1} [1-\frac{1}{K}] + \gamma Z^{-1} {1 - \frac{1}{Ke}}
        \]</span>
<ul>
<li>Z<sup>-1</sup> is the inverse of the standard Gaussian cdf</li>
<li>e is the exponential constant (i.e.&nbsp;2.71…)</li>
<li>γ is the Euler-Mascheroni constant (approx. 0.5772156649…)</li>
</ul></li>
<li>Useful for backtesting multiple strategies and deciding whether the strategy with the maximum sharpe ratio is significant (mitigates multiple testing bias)</li>
</ul></li>
<li><span style="color: #009499"><strong>Futures</strong></span> are an obligation to the buyer and a seller. The seller of the future agrees to provide the underlying asset at expiry, and the buyer of the contract agrees to buy the underlying at expiry. The price they receive and pay, respectively, is the price they entered the futures contract at. Most futures traders close out their positions prior to expiration since retail traders and hedge funds have little need to take physical possession of barrels of oil, for example. But, they can buy or sell the contract at one price, and if it moves favorably they can exit the trade and make a profit that way. Futures are a derivative because the price of an oil futures contract is based on the price movement of oil, for example.</li>
<li><span style="color: #009499"><strong>Hedge</strong></span> - an investment that is made with the intention of reducing the risk of adverse price movements in an asset. Normally, a hedge consists of taking an offsetting or opposite position in a related security. An example could be investing in both cyclical and counter-cyclical stocks.</li>
<li><span style="color: #009499"><strong>Hedge Ratio</strong></span> (<span style="color: #009499"><strong>delta</strong></span>) - The effectiveness of a derivative hedge, delta, is the amount the price of a derivative moves per $1 movement in the price of the underlying asset.</li>
<li><span style="color: #009499"><strong>Leg</strong></span> - one part or one side of a multistep trade. Legs should be exercised at the same time in order to avoid any risks associated with fluctuations in the price of the related security. So a purchase and sale should be made around the same time to avoid any price risk. Strategy often associated with derivatives trading.</li>
<li><span style="color: #009499"><strong>Limited Liability Corporation (LLC)</strong></span> - A corporation is a business organization that issues stock to its shareholders. A limited liability company is a business organization composed of members with membership interests. a type of legal entity that can be used when forming a business that offers protection to the owner(s) from personal liability for debts and other obligations that a business might incur. In other words, the personal assets of the owner cannot be used for legal claims against the business.The differences don’t really matter much at the taxation or day-to-day corporate level except in scale: LLCs tend to be smaller than corporations (more or less; a lot of people form small business corporations for good reasons and ignorant ones). (See <a href="https://www.investopedia.com/articles/personal-finance/011216/s-corp-vs-llc-which-should-i-choose.asp">Differences between a LLC and S Corp</a>)</li>
<li><span style="color: #009499"><strong>Market Capitalization</strong></span> - the total dollar market value of a company’s outstanding shares. Calculated by multiplying the total number of a company’s shares by the current market price of one share.</li>
<li><span style="color: #009499"><strong>Market Momentum</strong></span> - measure of overall market sentiment that can support buying and selling with and against market trends. In general, Momentum = Today’s price - Price from X days ago. Positive: bullish, Negative: bearish. More sophisticated indicators can be calculated, see https://www.investopedia.com/terms/m/marketmomentum.asp#:~</li>
<li><span style="color: #009499"><strong>Options</strong></span> - an option on&nbsp;stock XYZ gives the holder the right to buy or sell XYZ at the strike price up until expiration. The underlying asset for the&nbsp;option is the stock of XYZ. The&nbsp;writer must either buy&nbsp;or sell the underlying asset to the buyer on the specified date at the agreed-upon price. The buyer is not obligated to purchase the underlying asset, but they can exercise their right if they choose to do so. If the option is about to expire, and the underlying asset has not moved favorably enough to make exercising the option worthwhile, the buyer can let the expire and they will lose the amount they paid for the option.
<ul>
<li><span style="color: #009499"><strong>Put option</strong></span> - if Morty buys 100 shares of Stock plc (STOCK) at $10 per share, he might hedge his investment by buying an American put option with a strike price of $8 expiring in one year. This option gives Morty the right to sell 100 shares of STOCK for $8 any time in the next year. Let’s assume he pays $1 for the option, or $100 in premium. If one year later STOCK is trading at $12, Morty will not exercise the option and will be out $100. He’s unlikely to fret, though, since his unrealized gain is $100 ($100 including the price of the put). If STOCK is trading at $0, on the other hand, Morty will exercise the option and sell his shares for $8, for a loss of $300 ($300 including the price of the put). Without the option, he stood to lose his entire investment.</li>
<li><span style="color: #009499"><strong>Call options</strong></span> - contract giving the owner the right, but not the obligation, to buy a specified amount of an underlying security at a specified price within a specified time. The specified price is known as the <span style="color: #009499"><strong>strike price</strong></span> and the specified time during which a sale is made is its expiration (expiry) or time to maturity. As the price of the stock goes up, the value of the call option contract goes up. The contract can be sold at any time or you can purchase the stock at the guaranteed price on the expiration date. The price of the call option is called the premium.
<ul>
<li>If Apple is trading at $110 at expiry (aka expiration date), the strike price is $100, and the options cost the buyer $2, the profit is $110 - ($100 +$2) = $8. If the buyer bought one contract that equates to $800 ($8 x 100 shares), or $1,600 if they bought two contracts ($8 x 200). If at expiry Apple is below $100, then the option buyer loses $200 ($2 x 100 shares) for each contract they bought.</li>
<li>Suppose that Microsoft shares are trading at $108 per share. You own 100 shares of the stock and want to generate an income above and beyond the stock’s dividend. You also believe that shares are unlikely to rise above $115.00 per share over the next month. You take a look at the call options for the following month and see that there’s a 115.00 call trading at $0.37 per contract. So, you sell one call option and collect the $37 premium ($0.37 x 100 shares), representing a roughly four percent annualized income. If the stock rises above $115.00, the option buyer will exercise the option and you will have to deliver the 100 shares of stock at $115.00 per share. You still generated a profit of $7.00 per share, but you will have missed out on any upside above $115.00. If the stock doesn’t rise above $115.00, you keep the shares and the $37 in premium income.</li>
</ul></li>
</ul></li>
<li><span style="color: #009499"><strong>Outstanding Shares</strong></span> - the number of stocks that a company has issued. This number represents all the shares that can be bought and sold by the public, as well as all the restricted shares that require special permission before being transacted.</li>
<li><span style="color: #009499"><strong>Relative Performance</strong></span> - the price ratio of two stocks</li>
<li><span style="color: #009499"><strong>Sharpe Ratio</strong></span> <span style="color: #009499"><strong>(annualized)</strong></span> - measures the performance of an asset relative to violitility (i.e.&nbsp;riskiness)
<ul>
<li>(expected excess returns relative to a risk free asset (e.g.&nbsp;treasury bond) / sd of those expected excess returns) * √number_of_observations_in_a_year</li>
<li>Sharpe ratios above 1.0 are generally considered “good,” as this would suggest that the portfolio is offering excess returns relative to its volatility
<ul>
<li>Even if your sharpe ratio is above 1 it may not be good if it is below the average sharpe ratio of peer group portfolios.</li>
</ul></li>
<li>Multiplying by √number_of_observations_in_a_year makes “annualizes” the sharpe ratio and makes sharpe ratios comparable</li>
<li><u>Should NOT be thought of as t-stats for testing significance of the sample mean (i.e.&nbsp;p-values for estimates) since it doesn’t account for the number of observations</u>
<ul>
<li>See <span style="color: #009499"><strong>Sharpe Ratio (deflated)</strong></span></li>
<li>Investment professionals often use a rule of thumb of dividing the sharpe ratio by 2 when backtesting to avoid overfitting, there is no statistical basis for this.</li>
</ul></li>
</ul></li>
<li><span style="color: #009499"><strong>Sharpe Ratio (probabilistic)</strong></span> - allows you test the significance of the Sharpe Ratio under assumptions of ergodicity and stationarity (<a href="https://www.davidhbailey.com/dhbpapers/sharpe-frontier.pdf">Paper</a>)</li>
<li><span style="color: #009499"><strong>Sharpe Ratio (deflated)</strong></span> - the probability that an observed Sharpe Ratio was drawn from a distribution with positive mean after controlling for sample size (aka backtest length), skewness, kurtosis, and number of strategy variations explored.
<ul>
<li><p>Combines probabilistic sharpe ratio and false strategy theorem</p></li>
<li><p>Paper: <a href="https://www.davidhbailey.com/dhbpapers/deflated-sharpe.pdf">The Deflated Sharpe Ratio: Correcting for selection bias, backtest overfitting and non-normality</a></p>
<p><img src="./_resources/Finance.resources/Screenshot-(677).png" class="img-fluid" width="440"></p>
<ul>
<li>Shows that if a strategy has a maximum sharpe ratio of 1 but had 3 variations backtested, it’s deflated sharpe ratio drops below the 95% CI for a sharpe ratio = 1.</li>
</ul></li>
<li><p>Returns from investment strategies often exhibit autocorrelation, fat tails, and negative skewness which further “deflates” the deflated sharpe ratio</p></li>
</ul></li>
<li><span style="color: #009499"><strong>Slippage</strong></span>- The difference between where the computer signaled the entry and exit for a trade and where actual clients, with actual money, entered and exited the market using the computer’s signals. Along with transaction costs, it’s a cost that needs to be taken into account when analyzing the profitability of a strategy.</li>
<li><span style="color: #009499"><strong>Spread</strong></span> (<span style="color: #009499"><strong>Bid-Ask</strong></span>): The difference between two prices, rates or yields.
<ul>
<li>The gap between the bid and the ask prices of a security or asset, like a stock, bond or commodity.</li>
<li>The gap between a short position (that is, selling) in one futures contract or currency and a long position (that is, buying) in another. This is officially known as a spread trade</li>
</ul></li>
<li><span style="color: #009499"><strong>Volatility</strong></span>:
<ul>
<li>Parkinson Range (PR) = ln(closing_price) - ln(opening_price)</li>
</ul></li>
<li><span style="color: #009499"><strong>Yield</strong></span> a return measure for an investment over a set period of time, expressed as a percentage.
<ul>
<li>Includes price increases as well as any dividends paid, calculated as the net realized return divided by the principal amount (i.e.&nbsp;amount invested).</li>
<li>Higher yields are perceived to be an indicator of lower risk and higher income, but a high yield may not always be a positive, such as the case of a rising dividend yield due to a falling stock price.</li>
</ul></li>
</ul>
</section>
<section id="considerations" class="level2">
<h2 class="anchored" data-anchor-id="considerations">Considerations</h2>
<ul>
<li>Costs that need to be accounted for when backtesting
<ul>
<li>Transaction costs</li>
<li>Fees</li>
<li>Slippage</li>
<li>Taxes</li>
</ul></li>
<li>A model that performs well in a specific market condition may incur substantial losses when the market shifts, be it due to news, events, or economic changes.</li>
<li>Beware of survivorship bias when backtesting algorithms
<ul>
<li>Example: S&amp;P 500
<ul>
<li>A trader is creating an algorithm to predict prices of all the stocks in the S&amp;P 500. If the trader uses the current roster of companies, the list only includes companies that have made it to now without shutting down or losing so much value they drop off the list. The trader should use the list of companies as it was at the start of the training data.</li>
</ul></li>
</ul></li>
<li>Use proper stop-loss and position sizing strategies to manage risk</li>
<li>Iteratively using the <em>same</em> data to design and modify a strategy can lead to overfitting, where the strategy becomes overly tailored to the data and performs poorly in real-world trading.</li>
<li>Ignorance of macro-economic indicators and trends can result in unexpected market moves, significantly impacting algorithmic strategies and their performance.\</li>
<li>There are 435 choices for start and end dates of each monthly investment cycle
<ul>
<li>i.e.&nbsp;Easy to have a selective endpoints fallacy for an investment strategy.</li>
</ul></li>
</ul>
</section>
<section id="sec-finance-6040" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-6040">60/40 Portfolio Strategy</h2>
<ul>
<li>Misc
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://www.quantstart.com/qstrader/tutorial-60-40-portfolio/" style="color: goldenrod">QSTrader</a><span style="color: goldenrod">}}</span></li>
<li>Notes from - <a href="https://www.quantstart.com/articles/the-6040-benchmark-portfolio/">The 60/40 Benchmark Portfolio</a></li>
</ul></li>
<li>Description</li>
<li>60/40 US Equities/Bonds strategy is a simple long-term investment approach that is widely utilised in the investment industry. It seeks to ensure that at any point during the lifetime of the investment that 60% of account equity is invested in one or more assets representing a broad selection of US equities (such as an S&amp;P500 ETF), while 40% of account equity is invested in one or more assets representing a broad selection of US treasury bonds (such as a treasury bond ETF).</li>
<li>Since the actual percentage allocations of each asset class can deviate over time due to relative growth of the respective assets a ‘rebalance’ approach is often carried out. This means that trades are issued on a relatively infrequent basis to buy/sell amounts of each asset class to periodically bring the account equity allocations back into the 60/40 split. For the particular strategy implemented here we are using an end of month rebalance frequency.</li>
</ul>
</section>
<section id="sec-finance--momassallo" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance--momassallo">Momentum Tactical Asset Allocation Strategy</h2>
<ul>
<li>Misc
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://www.quantstart.com/qstrader/tutorial-60-40-portfolio/" style="color: goldenrod">QSTrader</a><span style="color: goldenrod">}}</span></li>
<li>Notes from
<ul>
<li><a href="https://www.quantstart.com/articles/systematic-tactical-asset-allocation-an-introduction/">Systematic Tactical Asset Allocation: An Introduction</a> - <a href="https://www.quantstart.com/qstrader/tutorial-momentum-tactical-asset-allocation-strategy/">Tutorial</a></li>
</ul></li>
</ul></li>
<li>Description
<ul>
<li>The US sector momentum strategy is a long-only dynamic tactical asset allocation strategy that attempts to exceed the performance of simply going long the S&amp;P500.</li>
<li>At the end of every month the strategy calculates the holding period return (HPR) based momentum of all of the SPDR sector ETFs (the ticker symbols of which begin with the prefix XL) and selects the top N to invest in for the forthcoming month, where N is usually between 3 and 6.</li>
<li>In the implementation given here the HPR momentum is calculated over the previous 126 days (approximately six months of business days) and the top three sector ETFs are chosen for the portfolio. The portfolio allocation is equally weighted between each of these three sector ETFs. Irrespective of changes in signal the portfolio is rebalanced once per month to weight the assets equally.</li>
</ul></li>
</ul>
</section>
<section id="sec-finance-vtp" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-vtp">Volatility Targeting Portfolio</h2>
<ul>
<li>Misc
<ul>
<li>The Impact of Volatility Targeting (<a href="https://www.man.com/maninstitute/the-impact-of-volatility-targeting#:~:text=Volatility%20targeting%20seeks%20to%20counter%20the%20fluctuations%20in%20volatility%3A,than%20a%20constant%20notional%20exposure.">paper</a>)</li>
<li>Quant Science <a href="https://www.quantscience.io/newsletter/b/automating-trades-interactive-brokers-and-python?ck_subscriber_id=2259292279">article</a> uses {{riskfolio}} to generate volatility weights for equities. (<a href="https://github.com/quant-science/sunday-quant-scientist/blob/main/QS002-automate-trades/automate-trades.py?ck_subscriber_id=2259292279">code</a>)
<ul>
<li><span style="color: goldenrod">{{</span><a href="https://riskfolio-lib.readthedocs.io/en/latest/index.html" style="color: goldenrod">riskfolio</a><span style="color: goldenrod">}}</span> - Good docs with plenty of examples</li>
</ul></li>
</ul></li>
<li>Volatility targeting seeks to counter the fluctuations in volatility:
<ul>
<li>It leads to leveraging a portfolio at times of low volatility, and scaling down exposures at times of high volatility.</li>
<li>This approach targets a constant level of volatility, rather than a constant notional exposure.</li>
</ul></li>
<li>Volatility clustering is a key feature of financial asset returns:
<ul>
<li>High volatility over the recent past tends to be followed by high volatility in the near future.</li>
</ul></li>
<li>Impact on Sharpe ratio
<ul>
<li>Volatility targeting improves the Sharpe ratio of “risk assets” (equities and credit), and that of “balanced” and “risk parity” portfolios that have a substantial allocation to these risk assets.</li>
<li>For equity and credit, volatility targeting effectively introduces some momentum overlay due to the so-called leverage effect: the negative relationship between returns and changes in volatility.</li>
<li>In contrast, for bonds, currencies, and commodities the impact on the Sharpe ratio is negligible.</li>
</ul></li>
<li>Impact on likelihood of tail events
<ul>
<li>Volatility targeting reduces the likelihood of extreme returns for all asset classes.</li>
<li>Importantly, “left-tail” events tend to be less severe, as they typically occur at times of elevated volatility, when a target-volatility portfolio has a scaled-down notional exposure.</li>
</ul></li>
</ul>
</section>
<section id="sec-finance-meanrev" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="sec-finance-meanrev">Mean Reversion Strategy or Pairs Trading</h2>
<ul>
<li>Match two trading vehicles that are highly correlated, trading one long and the other short when the pair’s price ratio diverges “x” number of standard deviations - “x” is optimized using historical data. If the pair reverts to its mean trend, a profit is made on one or both of the positions.</li>
<li>Chart the relative performance (price ratio)
<ul>
<li>The center white line represents the mean price ratio over the past two years. The yellow and red lines represent one and two standard deviations from the mean ratio, respectively.</li>
<li>The potential for profit can be identified when the price ratio hits its first or second deviation. When these profitable divergences occur it is time to take a long position in the underperformer and a short position in the overachiever. (i.e.&nbsp;shorting the stock that’s rising in relation to the other, and buying the other stock that hasn’t risen yet)</li>
<li>The revenue from the short sale can help cover the cost of the long position, making the pairs trade inexpensive to put on.</li>
<li>Position size of the pair should be matched by dollar value rather than number of shares; this way a 5% move in one equals a 5% move in the other.</li>
<li>As with all investments, there is a risk that the trades could move into the red, so it is important to determine optimized stop-loss points before implementing the pairs trade.</li>
</ul></li>
<li>Chart the spreads between returns</li>
<li>Look for stocks that move closely together and their:
<ul>
<li>Spreads zig-zag around zero</li>
<li>Prices separately (marginally) are normally distributed and joint-normally distributed (assumes linear correlation)
<ul>
<li>If both, then they move up AND down together (symmetric)</li>
<li>If only marginally, then they probably only move in one direction together (asymmetric)</li>
</ul></li>
</ul></li>
<li>If your two assets returns (differenced prices are stationary) do not correlate within a [0.7..0.8] correlation coefficient range at least 70% of the times (70% of all observations) then you’re probably dealing with a very bad hedging instrument
<ul>
<li>Look to cover the remaining data points and research why correlations broke down during those periods. If you can derive a mathematical relationship you could possibly formulate an approach in which you make adjustments to the hedge ratio through an adjustment in your beta/correlation coefficient.</li>
<li>Figure out the optimal time interval to retrain model due to data drift</li>
<li>Rolling 20-day correlation is a common way to monitor stock correlation</li>
</ul></li>
<li>Beware of two correlated stocks that have similar Beta or some other confounding variable
<ul>
<li>Graphical LASSO can help remove effects such as market Beta and recover real, direct relationships between stocks.
<ul>
<li>It makes intuitive sense that in a large universe, most stocks would be conditionally independent, and Graphical LASSO is able to refine this sparsity condition by tuning it’s only parameter</li>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/association-general.html#sec-assoc-gen-partcor" style="color: green">Association, General &gt;&gt; Partial Correlation</a> for a stock example</li>
</ul></li>
</ul></li>
<li>Copulas
<ul>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/association-copulas.html#sec-assoc-cop" style="color: green">Association, Copulas</a></li>
<li>Measures non-linear association</li>
<li>For Value-at-Risk (VAR) calculations, Gaussian copula is overly optimistic and Gumbel is too pessimistic</li>
<li>Copulas with upper tail dependence: Gumbel, Joe, N13, N14, Student-t.</li>
<li>Copulas with lower tail dependence: Clayton, N14 (weaker than upper tail), Student-t.</li>
<li>Copulas with no tail dependence: Gaussian, Frank.</li>
</ul></li>
<li>Cointegration allows us to construct a stationary time series from two asset price series, if only we can find the magic weight, or more formally, the cointegration coefficient β. Then we can apply a mean-reversion strategy to trade both assets at the same time weighted by β. There is no guarantee that such β always exists, and you should look for other asset pairs if no such β can be found.
<ul>
<li>See <a href="https://ercbk.github.io/Data-Science-Notebook/qmd/forecasting-statistical.html#sec-fcast-stat-terms" style="color: green">Forecasting, Statistical &gt;&gt; Terms</a></li>
<li>Cointegrated assets share common nonstationary components, which may include trend, seasonal, and stochastic parts</li>
<li>Might have low correlation, and highly correlated series might not be cointegrated at all.</li>
<li>Describes a long-term relationship between the prices (correlation describes a short-term relationship between the returns). The resulting stationary series is the spread between the prices of both assets</li>
<li>Should have similar risk exposure so that their prices move together</li>
<li>Good candidates for cointegrated pairs could be:
<ul>
<li>Stocks that belong to the same sector.</li>
<li>WTI crude oil and Brent crude oil.</li>
<li>AUD/USD and NZD/USD.</li>
<li>Yield curves and futures calendar spreads</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="bonds" class="level2">
<h2 class="anchored" data-anchor-id="bonds">Bonds</h2>
<ul>
<li>Misc
<ul>
<li>Resources
<ul>
<li><a href="https://www.nerdwallet.com/calculator/compound-interest-calculator?trk=nw_gn_5.0">NerdWallet Compound Interest Calculator</a>
<ul>
<li><span class="ribbon-highlight">Example</span>: if you put $5,000 in a (5yr) bond with a 4% yield, assuming you reinvest your interest payments, you will have $6083 by the time it matures.<br>
<img src="_resources/Finance.resources/nerdwallet-compound-interest-1.png" class="img-fluid" width="432"></li>
</ul></li>
</ul></li>
<li>Notes from
<ul>
<li><a href="https://www.wsj.com/finance/investing/investing-bonds-what-to-know-98e6f138?mod=e2twg">It’s a Good Time to Buy Bonds. Just Know What You’re Getting Into.</a></li>
</ul></li>
<li>The price of a bond moves in the opposite direction to interest rates.
<ul>
<li>As rates rise, the value of older bonds with lower coupons declines.&nbsp;</li>
</ul></li>
<li>Most often, people will compare the 2-year Treasury with the 10-year. So, any generic mention of the spread, in a bond context, refers to the difference in yield between these two bonds.</li>
<li>Bond traders buy existing bonds in the secondary bond market, and sell them at a discount to their face value.
<ul>
<li>The amount of the discount depends partially on how many payments are still due before the bond reaches maturity.</li>
<li>The price also is a bet on the direction of interest rates. If a trader thinks interest rates on new bond issues will be lower, the existing bonds may be worth a little more.</li>
</ul></li>
<li>Zero-Coupon Bonds (aka Discount Bonds)
<ul>
<li>Owners receive no payments for their money until the bond has matured.</li>
<li>They buy the bond for an amount that is less than its face value. When it reaches its maturity, they are paid the full face value of the bond.</li>
<li>Most zero-coupon bonds have a pre-set face value and therefore pay a pre-set amount of money at maturity.
<ul>
<li>Some bonds are inflation-indexed, meaning the face value is determined at maturity. The amount paid will be based on a standard measure such as the consumer price index plus a premium.</li>
</ul></li>
<li>Considered short-term investments that typically have a maturity of no more than one year. These short-term bonds are usually called <strong>bills</strong>.</li>
</ul></li>
</ul></li>
<li>Questions
<ul>
<li>Should you buy the highest-yielding bonds, or is it better to lock in good rates for longer?</li>
<li>Is it better to buy bonds directly from the government, a brokerage or as part of a bond fund?</li>
<li>How much do I make on bonds after taxes and fees?</li>
<li>How many bonds should I buy?</li>
</ul></li>
<li>Short-Term Bonds (e.g.&nbsp;2-year Treasury)
<ul>
<li>Pros:
<ul>
<li>Higher yields (i.e.&nbsp;return) than long term bonds (e.g.&nbsp;10-year Treasury)</li>
</ul></li>
<li>Cons:
<ul>
<li>When interest rates are high, you lose the opportunity (i.e.&nbsp;by not buying longer term bonds) to lock in a potentially higher return for longer should rates drop in the future.</li>
</ul></li>
</ul></li>
<li>Bond Ladder
<ul>
<li>Divide your investments among bonds with progressively later maturity dates.
<ul>
<li>Investors should also choose bonds based on savings goals and how soon they will need the money</li>
</ul></li>
<li>This takes advantage of both higher short term coupons and longer term yields.</li>
</ul></li>
<li>Considerations
<ul>
<li>Check a bond’s credit ratings before you buy. A poor rating means the bond issuer, such as a corporation, is less likely to pay you back.
<ul>
<li>This can be enticing because the issuer will likely offer you a higher interest rate. It also means they are more likely to default, which would mean you lose money.</li>
</ul></li>
<li>Watch out for hidden expenses like markup fees for purchasing an individual bond
<ul>
<li>Can be anywhere from 1% to 5%, depending on the broker.</li>
</ul></li>
<li>You are often not buying directly from the issuer. Instead, you are buying from another investor and the price of that bond probably has shifted since it was initially issued.
<ul>
<li>One advantage of using a brokerage is that their sites will take the guesswork out of how much the change in the market price of your bond will affect your final return.</li>
</ul></li>
<li>Taxes
<ul>
<li>CD interest, which may at time near bond yields, is taxed as ordinary income, as high as 37%.</li>
<li>The interest on Treasurys is exempt from state taxes.</li>
<li>Municipal bonds are exempt from both state and local taxes if an investor buys the bond from the same state they live in.</li>
<li>Corporate bonds have no tax benefits, so investors still need to pay both state and federal taxes on them.</li>
<li>Bonds within a tax-sheltered account like a 401(k) or an IRA aren’t taxed until you withdraw the money</li>
<li>If a zero-coupon bond is issued by a U.S. local or state government entity, interest is free from federal tax and generally exempt from state and local tax as well.
<ul>
<li>Zero-Coupon bonds subject to taxation in the U.S. can be held in a tax-deferred retirement account, allowing their investors to avoid tax on future income.</li>
</ul></li>
</ul></li>
</ul></li>
<li>Purchasing
<ul>
<li>Treasurys and most other bonds through a brokerage such as Charles Schwab, Fidelity or Vanguard.</li>
<li>Government bonds can also be bought directly from <a href="https://www.treasurydirect.gov/">TreasuryDirect</a>, a government website.</li>
<li>Bond funds and ETFs allow you to diversify your investment.
<ul>
<li>Bonds funds often don’t hold bonds until maturity.</li>
</ul></li>
</ul></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../qmd/epidemiology.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Epidemiology</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../qmd/healthcare.html" class="pagination-link">
        <span class="nav-page-text">Healthcare</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../LICENSE.html">Creative Commons Attribution-NonCommercial 4.0 International Public License</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>